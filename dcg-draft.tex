
%\documentclass{svjour3}                     % onecolumn (standard format)
%\documentclass[smallcondensed]{svjour3}     % onecolumn (ditto)
\documentclass[smallextended]{svjour3}       % onecolumn (second format)
%\documentclass[twocolumn]{svjour3}          % twocolumn
%
\smartqed  % flush right qed marks, e.g. at end of proof
%
\usepackage{graphicx}
%
\usepackage{amsmath,amssymb}
\usepackage{times}
\usepackage{enumerate}

\usepackage{mathrsfs}
% \usepackage{mathptmx}      % use Times fonts if available on your TeX system
%
% insert here the call for the packages your document requires
%\usepackage{latexsym}
% etc.
%
% please place your own definitions here and don't use \def but
% \newcommand{}{}
%

% \newtheorem{thm}{Theorem}[section]
% \newtheorem{cor}[thm]{Corollary}
% \newtheorem{lem}[thm]{Lemma}
% \newtheorem{prob}[thm]{Problem}

% %% Numbered objects of "non-theorem" style (text roman):
% \theoremstyle{definition}
% \newtheorem{defn}[thm]{Definition}
% \newtheorem{rem}[thm]{Remark}
% \newtheorem{exa}[thm]{Example}

%% Equations numbered by section:

\numberwithin{equation}{section}

%%%% Put your macros here:

%% Ticketing System
\usepackage{etoolbox}
\usepackage{xparse}
\NewDocumentCommand{\openTickets}{ > {\SplitList {,} } m }{\ProcessList{#1}{\BoolInit}}
\newcommand{\BoolInit}[1]{\providetoggle{#1}\toggletrue{#1}}
\newcommand{\todo}[2]{%
  \providetoggle{#1}%
    \iftoggle{#1}{%
    {\color{red}#2}%
    }{#2}%
}

\usepackage{tikz}
\usetikzlibrary{arrows,positioning,patterns,decorations.pathreplacing}

%% Ticket list
\openTickets{Manuel:convHull,Manuel:wlog,Manuel:invertability:assumption,Mark:log:bounds,Mark:proof:cor15,Manuel:proof:rewritten,Manuel:generic}

\providecommand{\norm}[1]{\left\|#1\right\|}
\providecommand{\abs}[1]{\left|#1\right|}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\interior}{int}
\DeclareMathOperator{\image}{im}
\DeclareMathOperator{\vertices}{vert}
\DeclareMathOperator*{\conv}{conv}
\DeclareMathOperator{\epi}{epi}

\newcommand*{\Resize}[1]{\resizebox{\columnwidth}{!}{$#1$}}

\DeclareFontFamily{U}{mathx}{\hyphenchar\font45}
\DeclareFontShape{U}{mathx}{m}{n}{
      <5> <6> <7> <8> <9> <10> gen * mathx
      <10.95> mathx10 <12> <14.4> <17.28> <20.74> <24.88> mathx12
      }{}
\DeclareSymbolFont{mathx}{U}{mathx}{m}{n}
\DeclareFontSubstitution{U}{mathx}{m}{n}
\DeclareMathSymbol{\temp}{\mathbin}{mathx}{'341}
\newcommand{\bigominus}{\raisebox{10pt}{$\temp$}}

\newcommand{\revision}[1]{\textcolor{blue}{#1}}
\newcommand{\highlight}[1]{\textcolor{red}{#1}}

% Insert the name of "your journal" with
% \journalname{myjournal}
%
\begin{document}

\title{Explicit Operations on Parametrised Polyhedra}%\thanks{Grants or other notes
%about the article that should go on the front page should be
%placed here. General acknowledgments should be placed at the end of the article.}
%\subtitle{Do you have a subtitle?\\ If so, write it here}

%\titlerunning{Short form of title}        % if too long for running head

\author{Rainer M. Schaich
\and 
Mark Cannon}

%\authorrunning{Short form of author list} % if too long for running head

\institute{R. M. Schaich: Department of Engineering Science,
  University of Oxford, Oxford, OX1 3PJ, UK; \email{rainer.schaich@eng.ox.ac.uk}
\and
M. Cannon:  Department of Engineering Science,
  University of Oxford, Oxford, OX1 3PJ, UK; \email{mark.cannon@eng.ox.ac.uk}}

\date{\today}

\maketitle


\begin{abstract}
The Pontryagin set difference is an operation between two sets that is used to calculate sets of safe operation in diverse applications including game theory and robust control.
%
We consider a particular class of set-valued maps; for this we introduce the property of parametric convexity and present some of its analytic framework.
%
In order to guarantee the convexity of the difference of a convex set and a set-valued map it proves necessary and sufficient that the set-valued map is parametrically convex.
%
For generic piecewise polyhedral set-valued maps we show that parametric convexity is equivalent to a fixed combinatorial structure of all its realisations.
%
We present a computational method for verifying parametric convexity of a piecewise polyhedral set-valued map as well as a way to calculate the parametric Pontryagin difference between a polyhedron and a piecewise polyhedral set-valued map.
%
Two examples are given to illustrate the presented methodology.

\keywords{Parametric convexity \and Piecewise affine set-valued map \and Pontryagin difference \and Parametrised polyhedra}

\subclass{52B55 \and 52A41 \and 90C25}
% 52A20 Convex sets in $n$ dimensions (including convex hypersurfaces)
% 52B55 Computational aspects related to convexity
% 52B11 $n$-dimensional polytopes
% 52A41 Convex functions and convex programs
% 52A30 Variants of convex sets (star-shaped, ($m, n$)-convex, etc.)
% 90C25 Convex programming
% 68U05 Computer graphics; computational geometry
% 52C45 Combinatorial complexity of geometric structures
\end{abstract}

% \linenumbers

\section{Introduction}
%
The Pontryagin difference was originally introduced (under the 
name Minkowski difference) as a set theoretic tool
in~\cite{Hadwiger:1950,Hadwiger:1957}. 
%However in the years since the term Minkowski difference has often been used to refer to a different operation.
%
It was implicitly reintroduced in the context of
differential games in~\cite{Pontryagin:1966}, where it was used to characterise safe sets for which there exist strategies for restricting system parameters to desired sets for all possible adversary actions.
%
Since its introduction, the usage of the Pontryagin difference has been extended beyond applications in differential games to various scenarios in which safe sets are needed to withstand unknown disturbances.
%
For example~\cite{blanchini:2007} describes its use as a robust
control analysis tool in several different contexts under the name
(set-)erosion. It has also found use in morphological image analysis, e.g.~\cite{Haralick:1987}.
%

When the Pontryagin difference has to be performed explicitly by numerical algorithms, it is usually assumed that the respective sets are polyhedral, since it is not possible to operate on general sets explicitly.
%
Algorithms to determine the Pontryagin difference between two
polyhedra do not require more complex computation than the solution of
linear programs~\cite{Kolmanovsky:1998,Kerrigan:2003}, and their
analytical properties are well-known, see e.g.~\cite{blanchini:2007,Haralick:1987,Kolmanovsky:1998}.
%
The sets on which these operations can be performed are fixed
predetermined polyhedra but, due to their physical interpretation in
terms of safe sets, it can be desirable to extend the class of sets on which these operations can be performed.
%
For this purpose we consider the case in which the subtrahend is a
set-valued map with a polyhedral realisation.

General set-valued maps have been studied analytically and various results are available in the literature, see e.g.~\cite{Aubin:2009}.
%
However, computational aspects of operations on general set-valued
maps are largely unknown. We refer to~\cite{Finzel:2000} for some results for polyhedral set-valued maps.
%
In this paper we present a particular class of set-valued map for which the Pontryagin difference can be computed explicitly.
%
The set-valued maps we consider are parametrised polyhedra with a property we introduce as \emph{parametric convexity} which allows us to guarantee that the \emph{parametric Pontryagin difference} is convex for all convex minuend sets.
%
We also describe computational methods that allow the parametric Pontryagin difference to be determined explicitly.

\revision{To motivate the main issues addressed by this paper using a very simple example, consider the problem of determining the safe set for the state $x$ of a system in order to ensure that the successor state $x^+ = x + w$ lies in a given set $S$, where $w$ is the action of an adversary that satisfies $w\in\mathcal W$ for some known set $\mathcal W$. The safe set for $x$ in this problem is precisely the Pontryagin difference between $S$ and $\mathcal W$.
%
Now suppose that the adversary action $w$ is not independent of $x$ but instead belongs to a set $\mathcal W(x)$ that depends explicitly on $x$. In this case the safe region is the set of points $x$ satisfying $x+w\in S$ for all $w\in \mathcal W(x)$, which is by definition the parametric Pontryagin difference between the set $S$ and the set-valued map $\mathcal W(x)$. 
%
To be of use as a computational tool, the Pontryagin difference between a convex set $S$ and a set-valued map $\mathcal W(x)$ should be convex for a well-defined class of maps $\mathcal W(x)$; the paper characterizes this class by introducing the concept of and conditions for parametric convexity. 
%
In many applications the sets of interest are either polyhedral or bounded by polyhedra. The paper determines the conditions under which a polyhedral set-valued map is parametrically convex, discusses computational methods for checking parametric convexity, and describes how to compute the parametric Pontryagin difference between a polyhedron and a polyhedral set-valued map.
}



The paper is structured as follows:
%
In Section~\ref{sec:preliminaries} we summarise preliminaries that are
required throughout the paper. In
Section~\ref{sec:parametric:convexity} we introduce parametric
convexity, which is the essential ingredient for all subsequent
analysis, and provide analytic results for set operations. 
We refine and extend these results for the case of set-valued maps with polyhedral realisations in Section~\ref{sec:polyhedral:maps}.
%
Section~\ref{sec:computational:methods} elaborates on how to determine whether a polyhedral map is in fact parametrically convex and how to perform operations on such set-valued maps, these concepts are then illustrated in Section~\ref{sec:numerical:examples} by numerical examples and finally we conclude the paper in Section~\ref{sec:conclusion}.


Throughout this paper we refer to the real $d$-dimensional parameter space as $Y\subseteq\mathbb R^d$, the $n$-dimensional realisation space as~$Z\subseteq\mathbb R^n$ and its power set~$\mathscr P(Z)$.
%
We denote the integer range~$\{1,\dots,m\}$ as~$\mathbb N_m$, and symbols $\mathcal A$, $\mathcal I$ are used to denote index sets.
%, the complement of a subset of an index set $\mathcal A\subset\mathcal I$ is denoted $\bar{\mathcal A}=\mathcal I\setminus\mathcal A$.
%, the objects $a_{\mathcal I}$ and $b_{\mathcal I}$ denote the matrix and the column vector with rows given by the row vectors $a_i$ and the scalar values $b_i$ with $i\in\mathcal I$.
%
By $f\vert_\Omega$ we mean $f$ evaluated only on $\Omega$. The $n$-ball of radius $r$ centred at $c$ is denoted $B_r^n(c)=\{x\in\mathbb R^n :\norm{x-c}_2\leq r\}$, where $\norm{\cdot}_2$ is the Euclidean norm.
%
\revision{The Minkowski sum~\cite{Minkowski:1911} of sets $X_1,X_2\subset\mathbb R^n$ and their Pontryagin difference are respectively denoted
\begin{align*}
X_1\oplus X_2 &=\{x_1 + x_2 : x_1\in X_1, \, x_2\in X_2 \} , \\
X_1\ominus X_2 &=\{x\in\mathbb R^n : x + x_2 \in X_1, \, \forall x_2\in X_2\} .
% X_1\oplus X_2 &=\{x\in\mathbb R^n : \exists x_1\in X_1, \, x_2\in X_2 \text{ such that } x = x_1+x_2 \} . \\
% X_1\ominus X_2 &=\{x\in\mathbb R^n : x+x_2 \in X_1, \, \forall x_2\in X_2\} .
\end{align*}
%
The projection of a set $X\subset \mathbb R^{n_2}$ onto $\mathbb R^{n_1}$, with $n_1\leq n_2$, is denoted 
\[
\pi_{n_1}(X) = \{x\in\mathbb R^{n_1}: (x,\tilde x)\in X, \, \tilde x\in\mathbb R^{n_2-n_1} \}.
\]
%
We use the terms `polyhedron' and `polyhedral set' interchangeably to denote any set that can be expressed as the intersection of finitely many closed half-spaces in $\mathbb{R}^n$, for arbitrary $n$.
The set of all vertices of a polyhedral set $X$ is denoted $\vertices(X)$.}
%
\section{Preliminaries}\label{sec:preliminaries}

The paper makes extensive use of the concept of a set-valued map; this is a function $f$ that maps an element of the metric space~$Y$ to a subset of the metric space~$Z$, i.e.\ $f:Y\mapsto\mathscr P(Z), Y\ni y\rightarrow f(y)\subset Z$. 
%
We refer the reader to~\cite{Aubin:2009} for a detailed discussion of the properties of set-valued maps. Here we only assume that the set-valued map is continuous in the sense that its \emph{graph} 
%
\begin{equation}
  \mathscr G(f) = \{(y,z)\in Y\times Z: z\in f(y)\} 
\end{equation}
%
has a continuous boundary $\partial\mathscr G(f)$.
%, so that for every point $(y,z)\in\partial\mathscr G(f)$ the boundary $\partial\mathscr G(f)$ is locally given by the graph of a continuous function.
%
We consider only set-valued maps with convex images, namely maps with the property that, for all $y\in Y$, we have $\lambda z_1+(1-\lambda)z_2\in f(y)$ for all $\lambda\in[0,1]$ if $z_1,z_2\in f(y)$.
%
An important class of set-valued maps are those with polyhedral realisations, so that $f(y)$ is a polyhedron for all $y\in Y$, and in particular we study polyhedral set-valued maps which depend on the \emph{parameter} $y$ in a piecewise affine way.
%
The graph of a  piecewise affine polyhedral set-valued map is given by a union of polyhedra~\cite{Finzel:2000}.

\revision{In Sections~\ref{sec:polyhedral:maps} and~\ref{sec:computational:methods}
of this paper we consider \emph{generic} polyhedral set-valued maps, which are defined as follows.}

\begin{definition}[Generic polyhedral set-valued map]\label{def:generic_polyhedral_set}
\revision{The polyhedral set-valued map $f(y)$ is said to be generic if $f(y)$ is a \emph{simple} polyhedron for all $y\in Y$ (except possibly on a subset of $Y$ of zero measure), and if $f(y)$ is \emph{structurally stable}. For given $y\in Y$, the polyhedral set $f(y) = \{z: a_i(y)z\leq b_i(y)\, \forall i\in \mathcal I\}\subset \mathbb R^n$ is simple if each of its vertices is supported by a minimal number of hyperplanes, i.e.~if for each vertex $v(y)$ there exists an index set $\mathcal A\subset \mathcal I$, with $\lvert \mathcal A\rvert = n$, such that $a_i(y)v(y)=b_i(y)$ for all $i\in\mathcal A$ and $a_i(y)v(y)<b_i(y)$ for all $i\in \mathcal I \setminus \mathcal A$.
%
Furthermore $f(y)$ is structurally stable if the combinatorial structure of $f(y)$ is unchanged when the functions $a_i(y)$, $b_i(y)$ are replaced by perturbed versions $a_i(y) + \epsilon u^{\!\top}$, $b_i(y)+\epsilon s$, for arbitrary $u\in B_1^n(0)$ and $s\in B_1^1(0)$, 
whenever $\epsilon> 0$ is sufficiently small.}
\end{definition}

% \revision{In Sections~\ref{sec:polyhedral:maps} and~\ref{sec:computational:methods}
% of this paper we consider \emph{generic} polyhedral set-valued maps, by which we mean set-valued maps with the properties that $f(y)$ is a \emph{simple} polyhedron for all $y\in Y$ (except possibly on a subset of $Y$ of zero measure), and that $f(y)$ is \emph{structurally stable}. The polyhedral set $f(y) = \{z: a_i(y)z\leq b_i(y)\, \forall i\in \mathcal I\}\subset \mathbb R^n$ is simple if each of its vertices is supported by a minimal number of hyperplanes, i.e.~if for each vertex $v(y)$ there exists an index set $\mathcal A\subset \mathcal I$, with $\lvert \mathcal A\rvert = n$, such that $a_i(y)v(y)=b_i(y)$ for all $i\in\mathcal A$ and $a_i(y)v(y)<b_i(y)$ for all $i\in \mathcal I \setminus \mathcal A$.
% %
% Furthermore we say that $f(y)$ is structurally stable if the combinatorial structure of $f(y)$ does not vary as $y$ varies over the interior of $Y$.}

%
% We note that $f(y)$ is simple almost everywhere in $Y$ if and only if it has a fixed number of vertices and rays for all $y\in Y$ except possibly on a subset of $Y$ with measure zero (i.e.~ a lower-dimensional polyhedron).}
%
%in the sense that if $f(y)$ is simple, then there exists a neighbourhood, $U$, of $y$ such that $f(\tilde y)$ is simple for all $\tilde y\in U$, and furthermore any subset of $Y$ on which $f(y)$ is not simple must be of measure zero (i.e.~a lower-dimensional polyhedron).}

% It is easy to see that if $A(\cdot)$ and $b(\cdot)$ are continuous in $y$, then $\mathcal I$ locally defines a vertex, i.e. the combinatorial structure of a simple polyhedron is structurally stable and therefore being simple is a generic property of a polyhedron.
% zero measure.
%
%In our analysis it will be self-evident what the set of points is, where the property of interest fails, in particular a lower dimensional polyhedron and we therefore omit a measure theoretic treatment of our assumption.
%
% The particular property we require is \emph{simplicity}, namely that for each $y\in Y$ the set $f(y)$ is a polyhedron and each of its vertices~$v(y)$ is supported by a minimal number of hyperplanes, i.e.~there exists a linear system defining the set $f(y) = \{z:A(y)z\leq b(y)\}$ and each vertex $v(y)$ is defined by $n$ hyperplanes $A_{\mathcal I}(y)v(y)=b_{\mathcal I}(y)$ and $A_{\bar{\mathcal I}}(y)v(y)<b_{\bar{\mathcal I}}(y)$.
% %
% It is easy to see that if $A(\cdot)$ and $b(\cdot)$ are continuous in $y$, then $\mathcal I$ locally defines a vertex, i.e. the combinatorial structure of a simple polyhedron is structurally stable and therefore being simple is a generic property of a polyhedron.

The induced graph~$G(P)$ of a polyhedron~$P$ is the graph with vertices and edges that coincide with the vertices and edges of the polyhedron itself~\cite{Bondy:2008}.
%
In this paper we only use one property of induced graphs, 
\revision{namely the \emph{Perles Conjecture} proved in~\cite{blind87} and~\cite{Kalai:1988}, which can be stated as follows:}
\emph{For a simple polytope~$P$ the graph~$G(P)$ determines the combinatorial structure of~$P$.}

\section{Parametric Convexity}\label{sec:parametric:convexity}

In this section we first define the property of \emph{parametric convexity} in the context of set-valued maps,
%
then we use this property to demonstrate the convexity of a generalised Pontryagin difference operation (see e.g.~\cite{Hadwiger:1950,blanchini:2007}). 
%
% In this section we refer to sets $Y\subseteq\mathbb R^d$ and $Z\subseteq\mathbb R^n$.
%
\begin{definition}[Parametric Convexity]\label{def:parametric:convexity}
Let $\mathcal W:Y\rightarrow \mathscr P(Z)$, where $Y\ni p\mapsto \mathcal W(p) \subset Z$, be a continuous set-valued map. The map $\mathcal W$ is called \emph{parametrically convex} if it satisfies
%
  \begin{equation}\label{eq:def:parametrically:convex}
  \mathcal W(\lambda p_1 + (1-\lambda)p_2)\subseteq\lambda \mathcal W(p_1) \oplus (1-\lambda) \mathcal W(p_2).
\end{equation}
for all $p_1,p_2\in Y$ and $\lambda\in (0,1)$.
\end{definition}
%
Although Definition~\ref{def:parametric:convexity} does not require convexity of~$\mathcal W(p)$, we only consider maps~$\mathcal W$ for which $\mathcal W(p)$ is convex for all fixed $p\in Y$ in the remainder of this paper.
%
\revision{We note that a similar definition is given in~\cite{Hadwiger:1957} for scalar families of sets ($d=1$), and set-valued maps satisfying~(\ref{eq:def:parametrically:convex}) are called \emph{concave} in~\cite{wasowicz16}, however in both cases the results presented are not directly related to the topic of this paper.}

\subsection{Properties of Parametrically Convex Maps}\label{ssec:properties:of:p:convex:maps}
%
We begin by introducing an equivalent characterisation of parametric convexity that provides an insight into the geometrical properties of 
set-valued maps satisfying~\eqref{eq:def:parametrically:convex}.
%
This is based on a description of parametric convexity in terms of conditions on the graph~$\mathscr G(\mathcal W)$ of a set-valued map.
%
\begin{definition}\label{def:graph:of:map}
Let $\mathcal W:Y\rightarrow \mathscr P(Z)$ be a continuous set-valued map
such that $\mathcal W(p)$ is convex for all $p\in Y$, then 
%
\begin{equation*}\begin{aligned}
\interior(\mathscr G(\mathcal W)) = \{(p,z) \in Y\times Z : \forall \zeta\in\mathbb R^n\;\exists \epsilon>0, \, z+\epsilon \zeta\in \mathcal W(p) \}
\end{aligned}\end{equation*}
%
denotes the \emph{interior} of its graph and
%
\[
  \partial \mathscr G(\mathcal W) = \mathscr G(\mathcal W)\setminus \interior(\mathscr G(\mathcal W))
\]
%
its \emph{boundary};
%
\revision{furthermore for any $(p,z)\in\partial\mathscr G(\mathcal W)$ the \emph{normal cone} is defined as}
%
\[
  \revision{\mathcal N_{\mathcal W} (p,z) = \{v \in\mathbb R^n: v^\top (y - z) \leq 0, \;  \forall y\in \mathcal W(p) \} .}
\]
%
\end{definition}
%
\begin{remark}
%
\revision{The normal cone $\mathcal N_{\mathcal W} (p,z)$  in  Definition~\ref{def:graph:of:map} belongs to the same space as $z$ rather than the space of the graph variable $(p,z)$; it consists of normals of hyperplanes in $\mathbb R^n$ that contain $z$ but no points in the interior of $\mathcal W(p)$.}
%
\end{remark}
%
The central idea connecting parametric convexity of a set valued map $\mathcal W$ with properties of its graph $\mathscr G(\mathcal W)$ is stated next.
%
\begin{lemma}\label{lem:p:convexity:graph}
  \revision{A set-valued map $\mathcal W$ satisfying $\mathcal W(p)\ni 0$ for all $p\in Y$
  is parametrically convex iff
%
\begin{equation}\label{eq:graph:def:p:convexity}
\lambda (p_1,z_1) + (1-\lambda) (p_2,z_2) \not\in \interior (\mathscr G(\mathcal W))
\end{equation}
%
holds for all $\lambda\in(0,1)$ and all $(p_1,z_1), (p_2,z_2)\in\partial\mathscr G(\mathcal W)$ such that  $\mathcal N_{\mathcal W}(p_1,z_1)\cap\mathcal N_{\mathcal W}(p_2,z_2)\neq\emptyset$.}
%
\end{lemma}
%
\begin{proof}\def\W{\mathcal{W}}\def\N{\mathcal{N}}
% 
  \revision{
    Consider the set $S$, defined for given $\lambda\in (0,1)$ and $p_1,p_2\in Y$ by
    \[
      S = \lambda \mathcal{W}(p_1) \oplus (1-\lambda) \mathcal{W}(p_2) 
      = \bigl\{ z : \lambda z_1 + (1 - \lambda) z_2, \ z_1 \in\mathcal W(p_1), \ z_2 \in\mathcal W(p_2) \bigr\} .
    \]
    We first show that $z\in \partial S = S \setminus \interior(S)$ if and only if
    $z = \lambda z_1 + (1 - \lambda) z_2$ for some $z_1\in\partial \mathcal W(p_1)$ and $z_2\in\partial \mathcal W(p_2)$ such that $\mathcal N_{\mathcal W}(p_1,z_1) \cap \mathcal N_{\mathcal W}(p_2,z_2) \neq \emptyset$.}
  
  \revision{If $z\in\partial S$, then there must exist $\zeta\in\mathbb R^n$ such that $z + \epsilon \zeta \notin S$ for all $\epsilon > 0$, which implies that it is not possible to find $z_1^\prime\in \mathcal{W}(p_1)$ and $z_2^\prime\in \mathcal{W}(p_2)$ such that $z + \epsilon \zeta =  \lambda z_1^\prime + (1 - \lambda) z_2^\prime$ for all $\epsilon > 0$. Hence $z_1\in\partial\W(p_1)$ and $z_2\in\partial\W(p_2)$ are necessary conditions for $z\in\partial S$.}

\revision{We therefore assume that $z = \lambda z_1 + (1-\lambda) z_2$ with $z_i\in\partial\W(p_i)$, $i=1,2$. Then $z+\zeta\in S$ if and only if there exists $\zeta_1$ or $\zeta_2$ such that $\zeta = \lambda\zeta_1$ or $(1-\lambda)\zeta_2$,  with $\zeta_i\in \N_\W^\ast(p_i, z_i)$, where $\N_\W^\ast(p_i, z_i)$ is the polar cone:
\[
% \zeta_i\in 
\N_\W^\ast(p_i,z_i) = \bigl\{ \zeta : v_i^\top\zeta \leq 0 \ \ \forall v_i\in\N_\W(p_i,z_i) \bigr\} .
\]
Therefore $z+\zeta\in S$ if and only if
$\zeta\in\N_\W^\ast(p_1,z_1)\cup \N_\W^\ast(p_2,z_2)$.
% since if $\zeta \in \N_\W^\ast(p_i, z_i)$ for $i=1$ or $2$,
% then $\zeta_1$ or $\zeta_2$ exists such that $\zeta = \lambda\zeta_1$ or $(1-\lambda)\zeta_2$, with $z_i+ \zeta_i\in\W(p_i)$ for $i=1$ or $2$.
It follows that $v$ lies in the normal cone to $S$ at $z$ if and only if 
\[
v^\top \zeta \leq 0 \ \ \forall \zeta\in\N_\W^\ast(p_1,z_1) \cup \N_\W^\ast(p_2,z_2),
\]
or equivalently, if and only if, for all $\zeta_i\in\N_\W^\ast(p_1,z_i)$,
%such that $v_i^T\zeta_i \leq 0$, $\forall v_i \in \N_W(p_i,z_i)$, 
$i=1,2$, we have
\begin{equation}\label{eq:normal_cone_cond}
v^\top \bigl( \mu \zeta_1 + (1-\mu) \zeta_2 \bigr) \leq 0 \ \ \forall \mu\in [0, 1].
\end{equation}
  % \revision{Specifically, if $z\in \partial S$ then $z\in S$ and there exists $\zeta\in\mathbb R^n$ such that $z + \epsilon \zeta \notin S$ for all $\epsilon > 0$.
  % %
  % Therefore we must have $z = \lambda z_1 + (1-\lambda ) z_2$ for $z_1\in\partial \mathcal W(p_1)$ and $z_2\in\partial \mathcal W(p_2)$, and furthermore there exists $\nu\in \mathbb R^n$ such that for all $\mu \in [0,1]$ we have
  % \begin{equation}\label{eq:normal_cone_cond}
  %   \nu^T \bigl( \mu \zeta_1 + (1-\mu) \zeta_2 \bigr) \leq 0 
  % \end{equation}
  % for all $\zeta_1$ and $\zeta_2$ such that $\nu_1^T\zeta_1 \leq 0$ and $\nu_2^T\zeta_2 \leq 0$ for all $\nu_1\in\mathcal N_{\mathcal W}(p_1,z_1)$ and $\nu_2\in\mathcal N_{\mathcal W}(p_2,z_2)$. Note that these conditions are equivalent to the requirement that the normal cone to $S$ at $z$ is non-empty.}
Clearly $v$ must lie in $\mathcal N_{\mathcal W}(p_1,z_1)$ (since $\mu = 1$ in (\ref{eq:normal_cone_cond}) gives $v^\top\zeta_1 \leq 0$) and similarly $v\in \mathcal N_{\mathcal W}(p_2,z_1)$ (since $\mu = 0$ in (\ref{eq:normal_cone_cond}) gives $v^\top\zeta_2 \leq 0$), and hence $\mathcal N_{\mathcal W}(p_1,z_1) \cap \mathcal N_{\mathcal W}(p_2,z_2) \neq \emptyset$ is necessary for $z\in\partial S$.
  %
  Furthermore $v\in \mathcal N_{\mathcal W}(p_1,z_1)\cap \mathcal N_{\mathcal W}(p_2,z_2)$ is also sufficient to ensure (\ref{eq:normal_cone_cond}) for all $\mu\in[0,1]$, and hence also sufficient for $z\in\partial S$.}
  %

  \revision{Given that $0\in\W(p)$ for all $p\in Y$, we must have $0\in\W\bigl(\lambda p_1 + (1-\lambda)p_2\bigr)$ and $0\in S$. Therefore condition (\ref{eq:graph:def:p:convexity}), when invoked for all $z\in\partial S$, is equivalent to  $\mathcal W\bigl(\lambda p_1 + (1-\lambda) p_2 \bigr) \subseteq S$. The proof is completed by applying the preceding argument for all $p_1,p_2\in Y$ and all $\lambda\in (0,1)$.}
\qed
% If $\lambda z_1 + (1-\lambda ) z_2 \in\partial S$, then (\ref{eq:graph:def:p:convexity}) is equivalent to $\mathcal W\bigl(\lambda p_1 + (1-\lambda) p_2 \bigr) \subseteq S$, and the proof is therefore completed by applying the preceding argument for all $(p_1,z_1) \in\partial\mathscr G(\mathcal W)$ and $(p_2,z_2)\in\partial\mathscr G(\mathcal W)$, and all $\lambda\in (0,1)$.
%   \qed
% %
% Assume~\eqref{eq:graph:def:p:convexity} holds for $(p_1,z_1),(p_2,z_2)\in\partial\mathscr G(\mathcal W)$.
% %
% Then the extension of the definition of the Minkowski functional (see e.g.~\cite{Rudin:91}) to the graph $\mathscr G(\mathcal W)$,
% \[
% \mu_{\mathscr G(\mathcal W)} \bigl(
% \mathcal W(p), z \bigr)
% := \min_\mu \{\mu \geq 0 : z \in \mu \mathcal W(p)\},
% \]
% yields $\mu_{\mathscr G(\mathcal W)}\left(\mathcal W(\lambda p_1 + (1-\lambda)p_2),\lambda z_1+(1-\lambda)z_2\right)\geq1$ for all $\lambda\in(0,1)$. Therefore $\lambda z_1 + (1-\lambda) z_2$
% lies either outside the set $\mathcal W(\lambda p_1+(1-\lambda)p_2)$ or on its boundary for all $\lambda\in(0,1)$, and hence the set of all possible interpolation points 
% %
% \[
% \begin{split}
%   \lambda \mathcal W(p_1)\oplus (1-\lambda)\mathcal W(p_2) = \{z : z=\lambda z_1 + (1-\lambda) z_2, z_1\in\mathcal  W(p_1),\, z_2\in\mathcal W(p_2)\}
% \end{split}
% \]
% %
% contains the set $\mathcal W(\lambda p_1 + (1-\lambda)p_2)$ for all $\lambda\in(0,1)$.
% %
% Furthermore, since $\lambda(p_1,z_1)+(1-\lambda)(p_2,z_2)\not\in \text{int}(\mathscr G(\mathcal W))$ and both $(p_1,z_1)$ and $(p_2,z_2)$ lie on the boundary, either $z_1-z_2$ or $z_2-z_1$ is outward facing for both $\mathcal W(p_1)$ and $\mathcal W(p_2)$; therefore either $z_1-z_2$ or $z_2-z_1$ lies in both $\mathcal N_{\mathcal W}(p_1,z_1)$ and $\mathcal N_{\mathcal W}(p_2,z_2)$ and hence also in their intersection.

% Now suppose that $\mathcal W$ is parametrically convex and that~\eqref{eq:graph:def:p:convexity} is not satisfied for 
% some $(p_1,z_1),(p_2,z_2)\in\partial\mathscr G(\mathcal W)$ with $\mathcal N_{\mathcal W}(p_1,z_1)\cap\mathcal N_{\mathcal W}(p_2,z_2)\neq\emptyset$, 
% %
% i.e.~that there exists $\epsilon>0$ such that the ball
% $B_\epsilon(\lambda z_1 + (1-\lambda)z_2 )$
% is contained in $\mathcal W(\lambda p_1 + (1-\lambda)p_2)$ for some $\lambda \in (0,1)$.
% %
% But this implies that $\lambda z_1 + (1-\lambda) z_2 + \epsilon\zeta \in \mathcal W(\lambda p_1+(1-\lambda)p_2)$  for all $\zeta\in\mathbb R^n$ such that $\|\zeta\| = 1$, whereas
% $\mathcal N_{\mathcal W}(p_1,z_1)\cap\mathcal N_{\mathcal W}(p_2,z_2)\neq\emptyset$ implies that there exists 
% $\zeta \in\mathcal N_{\mathcal W}(p_1,z_1)\cap\mathcal N_{\mathcal W}(p_2,z_2)$ which cannot be represented as
% $\zeta =\lambda \zeta_1+
% (1-\lambda)\zeta_2$
% with $z_1 + \epsilon \zeta_1\in\mathcal W(p_1)$ and $z_2  + \epsilon \zeta_2\in\mathcal W(p_2)$.
% %
% It follows that $\mathcal W$ cannot be parametrically convex.
% \qed
\end{proof}
%

\revision{%
Condition~\eqref{eq:graph:def:p:convexity} fails whenever the graph $\mathscr G(\mathcal W)$ is strictly convex.}
%
Indeed it is shown next that if $\mathscr G(\mathcal W)$ is strictly convex at any $(p,z)\in\partial \mathscr G (\mathcal W)$, then~\eqref{eq:graph:def:p:convexity} is violated and 
$\mathcal W$ cannot be parametrically convex.

%
\begin{theorem}\label{thm:inequalities:convex:concave}
%
Let $\mathcal W(p):=\{z\in\mathbb R^n: r(p,z)\leq0\}$ define a set-valued
map where 
$r: \mathbb R^d \times\mathbb R^n \rightarrow \mathbb R$, $(p,z)\mapsto r(p,z)$ is a continuous function which is convex in $z \in\mathbb R^n$, 
then $\mathcal W$ is parametrically
convex if and only if the function $r$ is concave in $p\in\mathbb R^d$.
%
\end{theorem}
%
\begin{proof}
First note that $r(p,z)$ is assumed to be a convex function of $z$ for any given value of $p$ so that $\mathcal W(p)$ is a convex set for each $p\in\mathbb R^d$.
%
Suppose that, for given $z\in\mathbb R^n$, $r(p,z)$ is a non-concave (i.e. 
strictly convex) function of $p$, for all $p$ in some region $\Omega\subseteq\mathbb R^d$. 
%
Then any convex subset $\mathcal C\subseteq\Omega$ will be such that $\mathscr 
G(\mathcal W)\vert_{\mathcal C}$ is a convex set.
%
Furthermore, for any $(p_1,z_1),(p_2,z_2)\in \partial\mathscr G(\mathcal W)\vert_{\mathcal C}$ we have
$\lambda (p_1,z_1) + (1-\lambda) (p_2,z_2) \in\interior (\mathscr G(\mathcal W))\vert_{\mathcal C}$ for all $\lambda\in(0,1)$ since
$\mathscr G(\mathcal W)\vert_{\mathcal C}$ is assumed to be strictly convex in $p$.
%
Hence~\eqref{eq:graph:def:p:convexity} is violated in this case, implying that $r(p,z)$ cannot be a non-concave function of $p$ in any non-empty set $\Omega$ if $\mathcal W$ is parametrically convex. 
%
Conversely, if $r(p,z)$ is concave in $p$ for all $p\in\mathbb R^d$, then the conditions of Lemma~\ref{lem:p:convexity:graph} necessarily hold.
\qed
\end{proof}
%
It is useful to be able to perform set certain set operations on set-valued maps, therefore we define the parametric Pontryagin difference:
%
\begin{definition}[Parametric Pontryagin Difference]\label{def:parametric:pontryagin:difference}
  Let $S\subseteq Z$ and let $\mathcal W:Z\to\mathscr P(Z)$ be a continuous set-valued map such that
  $\mathcal W(p)$ is convex for all $p\in Z$, then the \emph{parametric Pontryagin difference} 
  $S\ominus \mathcal W(S)$ is defined
%
\begin{equation}\label{eq:definition:parametric:pontryagin:difference}
    S\ominus \mathcal W(S) = \bigl\{z\in Z: \{z\} \oplus \mathcal W(z)\subseteq S\bigr\}.
  \end{equation}
%
\end{definition}
%
By a slight abuse of notation, $\mathcal{W}(S)$ is used in~(\ref{eq:definition:parametric:pontryagin:difference}) to indicate that $\mathcal{W}$ is a set-valued map and that $S\ominus\mathcal{W}(S)$ denotes the parametric Pontryagin difference, rather than a fixed set and the conventional Pontryagin difference. 
%
In fact the definition~(\ref{eq:definition:parametric:pontryagin:difference}) indicates that $S\ominus \mathcal{W}(S)$ only depends on the value of $\mathcal{W}(z)$ on a subset of $S$. 
%
%
For the parametric Pontryagin difference of a convex set and a parametrically convex map we 
have the following result.
%
\begin{theorem}\label{thm:convexity:of:pontryagin:difference}
Let $\mathcal W: Z\rightarrow\mathscr P(Z)$ be a given set-valued map, then the parametric Pontryagin difference $S \ominus \mathcal W(S)$ is convex for every convex $S\subseteq Z$ if and only if $\mathcal W$ is parametrically convex.
\end{theorem}
% \begin{theorem}\label{thm:convexity:of:pontryagin:difference}
%   Let $S\subseteq X$ be a convex set and let $\mathcal W:X\rightarrow\mathscr P(X)$ be a parametrically convex point-to-set
%   map such that $\mathcal W(p)$ is convex for all $p\in X$, then $S\ominus \mathcal W(S)$ is convex.
% \end{theorem}
%
\begin{proof}
To prove convexity of $S^\prime =  S\ominus \mathcal W( S)$ when $\mathcal W$ is parametrically convex we pick any $z_1,z_2\in S^\prime$, then
the definition of the parametric Pontryagin difference gives
\begin{equation}
  \{z_i\} \oplus \mathcal W(z_i) \subseteq S,\; i=1,2 
\end{equation}
%
and it can be verified that $S^\prime$ is convex by showing that line segments between all possible $z_1$ and $z_2$ are subsets of $S^\prime$. In particular, for all $\lambda \in (0,1)$ we have
\begin{align*}
  \{ \lambda z_1 + &(1-\lambda)z_2
  \}\oplus \mathcal W\left( \lambda z_1 + (1-\lambda)z_2\right)\\
  \subseteq&\left\{ \lambda z_1 + (1-\lambda)z_2
  \right\}\oplus \lambda \mathcal W(z_1) \oplus (1-\lambda)
  \mathcal W(z_2)\\
 = &\lambda\underbrace{(\{z_1\}\oplus \mathcal W(z_1))}_{\subseteq S}\oplus
  (1-\lambda)\underbrace{(\{z_2\}\oplus \mathcal W(z_2))}_{\subseteq S}\\
  \subseteq& S
\end{align*}
%
(where the last inclusion results from the convexity of $S$), and it follows that
$\lambda z_1 + (1-\lambda) z_2 \in S^\prime$ for all $\lambda \in (0,1)$. 
%the property, which follows from Definition~\ref{def:parametric:pontryagin:difference}, that $S\subseteq Z$.
%

To demonstrate that parametric convexity of $\mathcal W$ is necessary for convexity of $S\ominus \mathcal W(S)$ \revision{for all convex $S$}, suppose that condition~(\ref{eq:def:parametrically:convex}) does not hold and choose $z_1,z_2$ so that $\mathcal W(\lambda z_1 + (1-\lambda) z_2) \not\subseteq \lambda \mathcal W(z_1) \oplus (1-\lambda) \mathcal W (z_2)$ for some $\lambda \in (0,1)$. Then there exists a value of $\lambda\in(0,1)$ such that
\begin{align*}
  \{ \lambda z_1 + (1-&\lambda)z_2
  \}\oplus \mathcal W\left( \lambda z_1 + (1-\lambda)z_2\right)\\
  % \not\subseteq&\left\{ \lambda z_1 + (1-\lambda)z_2
  % \right\}\oplus \lambda \mathcal W(z_1) \oplus (1-\lambda)
  % \mathcal W(z_2)\\
 \not\subseteq &\lambda\bigl(\{z_1\}\oplus \mathcal W(z_1)\bigr)\oplus
  (1-\lambda)\bigl(\{z_2\}\oplus \mathcal W(z_2)\bigr) .
\end{align*}
Therefore \revision{if, for example, $S$ is a convex polyhedron such that} $\{z_1\}\oplus\mathcal W(z_1)$ and $\{z_2\}\oplus\mathcal W(z_2)$ contain points lying on the same facet of $S$ (this is always possible if $S^\prime=S\ominus \mathcal W(S)$ has a non-empty interior), then there exists $\lambda \in (0,1)$ such that $\lambda z_1 + (1-\lambda) z_2 \notin S^\prime$.
\qed
\end{proof}
%
Theorem~\ref{thm:convexity:of:pontryagin:difference} provides necessary and sufficient conditions for convexity of the parametric Pontryagin difference. 
%
In Section~\ref{sec:computational:methods}
we show that the parametric Pontryagin difference between a polyhedral set and a piecewise affine polyhedral set-valued map is itself polyhedral.
%
%
%
%
\section{Polyhedral maps}\label{sec:polyhedral:maps}
%
%
%
%
In this section we discuss set-valued maps~$\mathcal W$ for which~$\mathcal W(p)$ is polyhedral for all $p\in Y$, and in particular we consider the case that the dependence of $\mathcal W(p)$ on $p$ is piecewise affine. 
%
To the authors' knowledge the literature on piecewise affine polyhedral sets is limited to~\cite{Finzel:2000}, however properties of general set-valued maps are known and applicable, see e.g.~\cite{Aubin:2009}.
%

\begin{remark}
We note that the boundary of a polyhedral set is almost everywhere locally convex (i.e. concave but not strictly concave) and locally strictly convex around lower dimensional faces (vertices, edges, etc.).
%
This trivial but important fact is exploited throughout the following statements. 
%
As long as the boundary $\partial\mathscr G(\mathcal W)$ is locally affine in $p\in Y$, Theorem~\ref{thm:inequalities:convex:concave} applies. 
%
Conversely if the boundary $\partial\mathscr G(\mathcal W)$ is locally given by more than one affine function in $p$ (determined by linear inequalities), then it is locally strictly convex and therefore cannot be parametrically convex.
\end{remark}
%
\begin{theorem}\label{thm:polytopic:set:not:p:convex}
  \revision{The polyhedral parametric set-valued map $\mathcal W(p):=\{z\in \mathbb R^n : a_i z \leq b_i  + c_i p \; \forall i\in\mathbb N_m\}$, where $a_i\in\mathbb R^{1\times n}$, $b_i \in \mathbb R$ and $c_i \in \mathbb R^{1\times d}$ for $i\in\mathbb N_m$ are given parameters, is necessarily parametrically convex if $C=0$ and cannot be parametrically convex if $\rank( C ) > 1$, where $C = (\begin{matrix} c_1^\top & \cdots & c_m^\top\end{matrix})^\top$.}
% and only if the matrix $B^T = [\begin{matrix} b_1^T & \cdots & b_m^T\end{matrix}]$ is such that $\rank(B) \leq 1$.}
%is not parametrically convex for any $B^T = [\begin{matrix} b_1^T & \cdots & b_m^T\end{matrix}]$ such that $\rank (B) >1$.}
\end{theorem}
%
\begin{proof}
\revision{First assume that $C=0$. In this case the graph $\mathscr G(\mathcal W)$ is independent of $p$, i.e.
%
\begin{equation*}
	\mathscr G(\mathcal W) = \{(p,z):a_i z\leq b_i \; \forall i\in\mathbb N_m\},
\end{equation*}
%
which clearly satisfies the  conditions of Theorem~\ref{thm:inequalities:convex:concave}
%Lemma~\ref{lem:p:convexity:graph} 
for parametric convexity.
%
% Next assume $\rank(B)=1$. This implies that the image,  $\image(B)$, of $B$ is one-dimensional and in particular there exists $\gamma\in\mathbb{R}^m$ such that $\image(B) = \{\gamma t: t\in\mathbb R\}$.
% %
% This implies that the graph $\mathscr G(\mathcal W)$ can be expressed 
% %
% \begin{equation*}
%   \mathscr G(\mathcal W) = \{(t,z)\in\mathbb R^{1+n}:a_i z\leq c_i-\gamma_i t \; \forall i\in\mathbb N_m\} ,
% \end{equation*}
% %
% where $\mathcal W(t)$ is empty for all $t > t^\ast$ for some $t^\ast$, and $\mathcal W(t)$ is a scaled version of $\{ z : a_i z\leq c_i \; \forall i\in\mathbb{N}_m\}$ for all $t \leq t^\ast$.
% Hence the conditions of Theorem~\ref{thm:inequalities:convex:concave}
% %Lemma~\ref{lem:p:convexity:graph} 
% are again satisfied.}
% %
%
Now assume that $\text{rank}(C)=r> 1$. In this case $\image(C) = \{\Gamma t : t \in \mathbb R^r\}$ for  some $\Gamma \in\mathbb{R}^{m\times r}$,
  %
  and $\mathscr{G}(\mathcal W)$ can be expressed
  % 
% \begin{equation*}
%   \mathscr G(\mathcal W) = \Bigl\{(t,z)\in\mathbb R^{r+n}: \begin{pmatrix} a_{\mathbb N_m} & -\Gamma \end{pmatrix}  \begin{pmatrix} z \\ t \end{pmatrix} \leq b_{\mathbb N_m} \Bigr\} \end{equation*}
\begin{equation*}
  \mathscr G(\mathcal W) = \Bigl\{(p,z) : a_i z \leq b_i + \sum_{j=1}^r \gamma_{i,j} t_j \; \forall i\in\mathbb N_m,\; t =\Gamma^\dagger Cp \Bigr\},
\end{equation*}
%
where $\gamma_{i,j}$ is the $(i,j)$th element of $\Gamma$ and $\Gamma^\dagger = (\Gamma^\top\Gamma)^{-1}\Gamma^\top$.
%
But this implies that the graph $\mathscr G(\mathcal W)$ is locally strictly convex, and hence $\mathcal W(p)$ violates the conditions of Theorem~\ref{thm:inequalities:convex:concave} in this case.}
 % given by a convex polyhedron that has vertices in the parameter space, which implies that the graph is locally strictly convex and $\mathcal W(p)$ therefore violates Lemma~\ref{lem:p:convexity:graph}.}
\qed
\end{proof}
%

\revision{In the special case of $\rank(C)=1$, the map $\mathcal W(p)=\{ z : a_i z \leq b_i + c_i p \; \forall i \in \mathbb N_m\}$ considered in Theorem~\ref{thm:polytopic:set:not:p:convex} may or may not be parametrically convex. For example, if $\image(C) = \{ \Gamma t : t\in\mathbb R\}$, with $\Gamma = (\begin{matrix} b_1 & \cdots & b_m\end{matrix})^\top$, then $\mathscr G(\mathcal W)$ is a translated polyhedral cone,
\[
\mathscr G(\mathcal W) = \{ (p , z) : a_i z \leq b_i t \; \forall i\in\mathbb N_m, \; t = \Gamma^\dagger C p + 1\} ,
\]
(where $\Gamma^\dagger = \Gamma^\top/(\Gamma^\top\Gamma)$),
which necessarily satisfies the conditions of Theorem~\ref{thm:inequalities:convex:concave}. On the other hand, if $\Gamma = (\begin{matrix} 0 & \cdots & 0 & b_m\end{matrix})^\top$, then $\mathscr G(\mathcal W)$ can be expressed
\begin{equation}\label{eq:graph:non-generic:1-d}
\mathscr G(\mathcal W) = \{ (p ,z): a_i z \leq b_i  \; \forall i\in\mathbb N_{m-1}, \; a_m z \leq b_m t ,\; t = \Gamma^\dagger C p + 1\} 
\end{equation}
(where $\Gamma^\dagger = (\begin{matrix} 0 & \cdots & 0 & b_m^{-1}\end{matrix})$).
In this case $\mathcal W(p)$ cannot be parametrically convex whenever the set $\{ z\in\mathbb R^n : a_iz \leq b_i \; \forall i\in\mathbb N_{m-1}\}$ is compact, since $\mathscr G(\mathcal W)$ is then locally strictly convex. The case of $\rank(C)=1$ is a special case of Theorem~\ref{thm:p:convexity:PWA:set:constant:num:verts}, which is given next. In fact this example provides a useful insight into Theorem~\ref{thm:p:convexity:PWA:set:constant:num:verts}, since if $a_i\neq a_j$ for all $i,j\in\mathbb N_m$, then by inspection of (\ref{eq:graph:non-generic:1-d}) it can be seen that 
%$\mathcal W(p)$ is non-generic, in the sense that 
the number of vertices of $\mathcal W(p)$ varies with $p$. A key contribution of Theorem~\ref{thm:p:convexity:PWA:set:constant:num:verts} (which is stated in terms of piecewise affine set-valued maps, so $a_i\neq a_j$ for all $i,j\in\mathbb N_m$ can be assumed without loss of generality) is that $\mathcal W(p)$ is parametrically convex in this special case if and only if the number of vertices of $\mathcal W(p)$ is fixed for all $p\in Y$ (with the possible exception of a zero measure subset of $Y$).}

\revision{Theorem~\ref{thm:p:convexity:PWA:set:constant:num:verts} applies to piecewise affine polyhedral set-valued maps defined by
\begin{equation}\label{eq:definition:PWA:polytopic:set:general}
  \mathcal W(p) := \Bigl\{z\in\mathbb R^n: a_i z \leq \max_{k\in\mathbb N_q}\{b_{i,k} + c_{i,k}p\} \; \forall i\in\mathbb N_m \Bigr\} 
\end{equation}
where $a_i\in\mathbb R^{1\times n}$, $b_{i,k} \in \mathbb R$ and $c_{i,k} \in \mathbb R^{1\times d}$ for $i\in\mathbb N_m$ and $k\in\mathbb N_q$ are given parameters.
Here the right hand side of each inequality defining $\mathcal W(p)$ is a multi-parametric linear program (mpLP):  $\phi_i(p) = \max_{k\in\mathbb N_q} \{b_{i,k} + c_{i,k}p\}$,
the solution of which is a continuous piecewise affine function, $\phi_i(p) = b_{i,k^\ast_i} + c_{i,k^\ast_i}p$, where $k^\ast_i(p)$ is piecewise constant on a polyhedral complex, see e.g.~\cite{spjotvold07}.
%
This means that there exists a finite partition of $Y\subseteq\mathbb R^d$ into closed convex polyhedra 
$\mathcal P_j$ such that $\bigcup_{j\in\mathcal I} \mathcal P_j = Y$ and 
${\bf{k}}^\ast(p) = (k_1^\ast(p),\dots,k_m^\ast(p))$ is constant for all $p \in \mathcal P_j$.
%
Hence the graph $\mathscr G(\mathcal W)$ is given by a finite union of polyhedra
%
\begin{equation*}
  \mathscr G(\mathcal W) = \bigcup_{j\in\mathcal I} \left\{(p,z): a_i z \leq b_{i,k_i^\ast} + c_{i,k_i^\ast}p \; \forall i \in\mathbb N_m \right\}\bigr\vert_{\mathcal P_{j}} .
\end{equation*}
A linear inequality defining $\mathcal W(p)$ is \emph{active} at $(p,z)\in\partial\mathscr G (\mathcal W)$ if it holds with equality, and \emph{inactive} if it holds with strict inequality. We denote the set of active constraints at any point $(p,z)\in\partial\mathscr G (\mathcal W)$ as the index set $\mathcal A (p,z)$ defined by
\begin{align*}
&a_i z = b_{i,k_i^\ast} + c_{i,k_i^\ast} p \quad\forall i \in \mathcal A (p,z) \\
&a_i z < b_{i,k_i^\ast} + c_{i,k_i^\ast} p \quad \forall i \in \mathbb N_m \setminus \mathcal A (p,z) .
\end{align*}
Before stating Theorem~\ref{thm:p:convexity:PWA:set:constant:num:verts} we first give two intermediate results.}
 
%Finally we note that any zero measure subset of $Y\subseteq\mathbb R^d$ referred to in the following statements about piecewise affine polyhedral maps necessarily has the form of a polyhedral set of dimension less than $d$.}

%In the following statements we use the terminology \emph{almost everywhere} in $Y$ to indicate all points in $Y$ except a subset of $Y$ of zero measure, namely a lower-dimensional polyhedral subset of $Y$.}

%Theorem~\ref{thm:p:convexity:PWA:set:constant:num:verts} is stated in terms of generic piecewise affine polyhedral maps, which implies that their realisation is simple and no more than one structural component can change at a time as $p$ varies.

%
%The second assumption will become clearer in the proof of the central statement for piecewise affine polytopic set-valued maps and makes the statement of Lemma~\ref{lem:p:convexity:graph} more specific.
%

% \begin{lemma}\label{lem:sep_hyperplane}
% \revision{Let the affine polyhedral map (\ref{eq:definition:PWA:polytopic:set:general}) be such that $\lvert \vertices\bigl(\mathcal W(p)\bigr) \rvert = \nu$ for all $p\in Y$ except a zero measure subset of $Y$. Then 


% for any $(p_i,z_i)\in \partial \mathscr G (\mathcal W)$, $i=1,2$ we have $\mathcal N_{\mathcal W}(p_1,z_1) \cap \mathcal N_{\mathcal W}(p_2,z_2) \neq \emptyset$ if and only if $\mathcal A(p_1,z_1) \cap \mathcal A(p_2,z_2)\neq \emptyset$.}


\begin{lemma}\label{lem:active_set}
\revision{For a given integer $\nu$, let the piecewise affine polyhedral set-valued map (\ref{eq:definition:PWA:polytopic:set:general}) satisfy $\lvert \vertices (\mathcal W(p) ) \rvert = \nu$ for all $p\in Y$ except a zero measure subset of $Y$. Then, for any $(p_1,z_1)\in \partial \mathscr G (\mathcal W)$ and $(p_2,z_2)\in \partial \mathscr G (\mathcal W)$, we have $\mathcal N_{\mathcal W}(p_1,z_1) \cap \mathcal N_{\mathcal W}(p_2,z_2) \neq \emptyset$ if and only if $\mathcal A(p_1,z_1) \cap \mathcal A(p_2,z_2)\neq \emptyset$.}
\end{lemma}

\begin{proof}
\revision{
The definition of the active set $\mathcal A(p,z)$ implies that the normal cone at $(p,z)\in \partial \mathscr G (\mathcal W)$ is given by 
\begin{equation}\label{eq:normal_cone_face_normals}
\mathcal N_{\mathcal W}(p,z) = \sum_{i\in\mathcal A(p,z)} \lambda_i a_i, \quad \lambda_i \geq 0 \ \ \forall i\in\mathcal A(p,z) ,
\end{equation}
and it follows immediately that $\mathcal A(p_1,z_1) \cap \mathcal A(p_2,z_2)\neq \emptyset$ is a sufficient condition for $\mathcal N_{\mathcal W}(p_1,z_1) \cap \mathcal N_{\mathcal W}(p_2,z_2) \neq \emptyset$, for any $(p_i,z_i)\in \partial \mathscr G (\mathcal W)$, $i=1,2$. 
%
We show next that this condition is also necessary for $\mathcal N_{\mathcal W}(p_1,z_1) \cap \mathcal N_{\mathcal W}(p_2,z_2) \neq \emptyset$.
%
Specifically, if the number of vertices of $\mathcal W(p)$ is fixed for all $y\in Y$, then for each $i\in\mathcal A(p_1,z_1)$: (i) there must exist $z\in\mathcal W(p_2)$ such that $i\in\mathcal A(p_2,z)$; and (ii) if $i\not\in\mathcal A(p_2,z_2)$, then there must exist $u\in\mathbb R^n$ such that 
\begin{equation}\label{eq:separating_hyperplane}
a_i u \geq 0 \quad \text{and} \quad a_j u < 0 \ \ \forall j\in \mathcal A(p_2,z_2).
\end{equation}
Note that properties (i) and (ii) also hold if $\lvert\vertices(\mathcal W(p))\rvert$ is fixed for all $p\in Y$ except a zero measure subset of $Y$ since the right hand side of each inequality defining $\mathcal W(p)$ is continuous in $p$.
% Specifically, the assumption that the number of vertices of $\mathcal W(p)$ is fixed for all $p\in Y$ except possibly a zero-measure subset of $Y$ implies that for each $i\in\mathcal A(p_1,z_1)$ there must exist $z\in\mathcal W(p_2)$ such that $i\in\mathcal A(p_2,z)$, and furthermore, if $i\not\in\mathcal A(p_2,z_2)$, then there must exist $u\in\mathbb R^n$ such that 
% \begin{equation}\label{eq:separating_hyperplane}
% a_i u \geq 0 \quad \text{and} \quad a_j u < 0 \ \ \forall j\in \mathcal A(p_2,z_2).
% \end{equation}
Now suppose that $\mathcal N_{\mathcal W}(p_1,z_1) \cap \mathcal N_{\mathcal W}(p_2,z_2) \neq \emptyset$. In this case (\ref{eq:normal_cone_face_normals}) implies that there must exist $i\in\mathcal A(p_1,z_1)$ such that 
\begin{equation}\label{eq:overlapping_normal_cones}
a_i = \sum_{j\in\mathcal A(p_2,z_2)} \lambda_j a_j, \quad \lambda_j \geq 0 \ \ \forall j\in\mathcal A(p_2,z_2) ,
\end{equation}
%but we must also have $i\not\in\mathcal A(p_2,z_2)$ 
and if $\mathcal A(p_1,z_1)\cap\mathcal A(p_2,z_2) = \emptyset$, then we must also have $i\not\in\mathcal A(p_2,z_2)$. But (\ref{eq:separating_hyperplane}) would then contradict (\ref{eq:overlapping_normal_cones}), and it follows that
$\mathcal N_{\mathcal W}(p_1,z_1) \cap \mathcal N_{\mathcal W}(p_2,z_2) \neq \emptyset$ 
only if $\mathcal A(p_1,z_1)\cap\mathcal A(p_2,z_2) \neq \emptyset$.}
\qed
\end{proof}

\begin{lemma}\label{lem:vert_change}
\revision{Let $p_i$ for $i=1,2$ be such that the piecewise affine polyhedral map (\ref{eq:definition:PWA:polytopic:set:general}) satisfies $\lvert \vertices(\mathcal W(p)) \rvert = \nu_i$ for some integer $\nu_i$,
%for all $p$ in an open neighbourhood of $p_i$. 
for all $p\in U_i\subset Y$, where $U_i$ is an open set containing $p_i$. 
If $\nu_1\neq \nu_2$ and $\mathcal W(p)$ is generic in the sense of Definition~\ref{def:generic_polyhedral_set}, then $\mathcal W(p)$ cannot be parametrically convex.}
\end{lemma}

\begin{proof}
\revision{%
Under the conditions of the lemma, the number of vertices of $\mathcal W(p)$ must change as $p$ moves along any path in $Y$ from $U_1$ to $U_2$. Therefore $\lvert \vertices (\mathcal W(p)) \rvert$ must change at a point $p$ that lies either in the interior of an element, $\mathcal P_j$ $j\in\mathcal I$, of the partition of $Y$, or on a boundary, $\mathcal P_j\cap\mathcal P_k$, for $j,k\in\mathcal I$. 
%
However the latter case cannot occur if $\mathcal W(p)$ is generic because it would imply a structural instability (since arbitrarily small perturbations in the parameters $a_i,b_{i,k_i^\ast},c_{i,k_i^\ast}$ would cause a change in the combinatorial structure of $\mathcal W(p)$), which is not admissible under Definition~\ref{def:generic_polyhedral_set}.
%
On the other hand, if $\lvert \vertices (\mathcal W(p)) \rvert$ changes at a point $p$ in the interior of $\mathcal P_j$, then $\mathscr G(\mathcal W)\vert_{\mathcal P_j}$ is locally a strictly convex polyhedron, and Theorem~\ref{thm:inequalities:convex:concave} implies that $\mathcal W(p)$ cannot be parametrically convex in this case.} \qed
\end{proof}


The main result of this section is given next.
% derived from Lemmas~\ref{lem:active_set} and~\ref{lem:vert_change}. 

\begin{theorem}\label{thm:p:convexity:PWA:set:constant:num:verts}
The generic piecewise affine polyhedral map (\ref{eq:definition:PWA:polytopic:set:general})
is parametrically convex \revision{if and only if there exists an integer $\nu$ such that 
$\lvert\vertices(\mathcal W(p))\rvert = \nu$
%$\mathcal W(p)$ has a fixed number of vertices 
for all $p\in Y$ except a zero measure subset of $Y$.}
%with the possible exception of a subset of $Y$ of zero measure.}
\end{theorem}
%

\begin{proof}
\revision{
The necessity of the requirement that the number of vertices of $\mathcal W(p)$ is fixed 
%for some given $\nu$, $\lvert \vertices\bigl(\mathcal W(p)\bigr) \rvert =\nu$ 
for all $p\in Y$ (except possibly on a zero measure subset of $Y$) follows directly from Lemma~\ref{lem:vert_change}. Sufficiency can be demonstrated using Lemmas~\ref{lem:p:convexity:graph} and~\ref{lem:active_set}. Thus if $(p_1,z_1),(p_2,z_2)\in\partial \mathscr G(\mathcal W)$ and $\mathcal N_{\mathcal W}(p_1,z_1) \cap \mathcal N_{\mathcal W} (p_2, z_2) \neq \emptyset$, then Lemma~\ref{lem:active_set} implies that there exists an index, $h$, that belongs to both $\mathcal A(p_1,z_1)$ and $\mathcal A(p_2,z_2)$. Expressing $\mathcal W(p)$ as  
\[
\mathcal W(p) = \{ z : r(p,z) \leq 0\}, \ \ 
r(p,z) = \max_{i\in\mathbb N_m} \bigl\{ a_i z - \max_{k\in\mathbb N_q} \{ b_{i,k} + c_{i,k} p \} \bigr\},
\]
we therefore have $r(p_j,z_j) = a_h z_j - \max_{k\in\mathbb N_q} (b_{h,k} + c_{h,k} p_j ) = 0$ for $j = 1,2$ and
\begin{align*}
&r\bigl(\lambda p_1 + (1\!-\!\lambda) p_2, \lambda z_1 + (1\!-\!\lambda) z_2\bigr) \\
&= 
\max_{i\in\mathbb N_m} \Bigl\{ a_i \bigl(\lambda z_1 + (1\!-\!\lambda) z_2\bigr) - \max_{k\in\mathbb N_q} \bigl\{ b_{i,k} + c_{i,k}\bigl(\lambda p_1 + (1\!-\!\lambda) p_2\bigr) \bigr\} \Bigr\} \\
&\geq
\max_{i\in\mathbb N_m} \Bigl\{  a_i \bigl(\lambda z_1 + (1\!-\!\lambda) z_2\bigr)
- \lambda \max_{k\in\mathbb N_q} \{ b_{i,k} + c_{i,k} p_1\} 
- (1\!-\!\lambda) \max_{k\in\mathbb N_q} \{ b_{i,k} + c_{i,k} p_2\} \Bigr\} \\
&\geq
\lambda \bigl ( a_h z_1 - \max_{k\in\mathbb N_q} \{ b_{h,k} + c_{h,k} p_1\} \bigr) + (1\!-\!\lambda) \bigl( a_h z_2 - \max_{k\in\mathbb N_q} \{ b_{h,k} + c_{h,k} p_2\} \bigr) \\
&\geq 0
\end{align*}
for all $\lambda\in (0,1)$. It follows that $\lambda(p_1,z_1)+(1-\lambda) (p_2,z_2) \notin \interior (\mathscr G(\mathcal W))$ for all $\lambda\in (0,1)$, and hence $\mathcal W(p)$ meets the conditions of Lemma~\ref{lem:p:convexity:graph} for parametric convexity.}
\qed
\end{proof}


%
Theorem~\ref{thm:p:convexity:PWA:set:constant:num:verts} can be reformulated in a computationally useful way as follows.
%
\begin{corollary}\label{thm:combinatorical:equivalence:alternative}
The generic piecewise affine polyhedral map (\ref{eq:definition:PWA:polytopic:set:general})
is parametrically convex if and only if $\mathcal W(p_1)$ and $\mathcal W(p_2)$ are combinatorially equivalent for all $p_1,p_2\in Y$ except a zero measure subset of $Y$.
%, i.e.\ $\mathcal W(p_1)\cong\mathcal W(p_2)$.
\end{corollary}
%
\begin{proof}
Two polyhedra are combinatorially equivalent if there exists a bijection between their faces (vertices, edges, facets, etc) which preserves the inclusion relationships between them, see e.g.~\cite{Ziegler:1995}.
%
\revision{It is clear that if the number of vertices of $\mathcal W(p)$ is fixed for all $p\in Y$, then although the shape of~$\mathcal W(p)$ might change, all facets of $\mathcal W(p)$ are defined by the same set of hyperplanes for all $p\in Y$.
%its combinatorial structure does not.
%
The induced graph of a polytope is defined by the vertices and the edges of the polytope, and therefore the induced graph, $G(\mathcal W(p))$, of $\mathcal W(p)$, must be independent of $p$ if $\lvert\vertices(\mathcal W(p))\rvert$ is fixed for all $p\in Y$.
%
The Perles Conjecture, as proved in~\cite{Kalai:1988}, shows that the combinatorial structure of a simple polytope is determined uniquely by its induced graph; hence if $G(\mathcal W(p))$ does not vary with $p$, then neither does the combinatorial structure of $\mathcal W(p)$, and it follows that $\mathcal W(p_1)$ and $\mathcal W(p_2)$ are combinatorially equivalent for all $p_1,p_2\in Y$. Conversely, if $\lvert\vertices(\mathcal W(p))\rvert$ varies with $p$, then $\mathcal W(p_1)$ and $\mathcal W(p_2)$ cannot be combinatorially equivalent for all $p_1,p_2\in Y$.
%
% This is only possible if it is constant itself or it abruptly changes on multiple edges, however changing multiple edges involves changing multiple active sets which is a degenerate case.
%
Although the preceding argument ignores the possibility that $\mathcal W(p)$ is non-simple on a zero-measure subset of $Y$, we can define a continuous selection through these sets since the combinatorial structure of $\mathcal W(p)$ is by assumption fixed for values of $p$ arbitrarily nearby.}
%
%This means in particular that we ignore the fact that locally $v_{\kappa_1}=v_{\kappa_2}$ and can  use a locally redundant representation $\mathcal W(p) = \conv_\kappa\{v_\kappa(p)\}$.
\qed
\end{proof}

%
Corollary~\ref{thm:combinatorical:equivalence:alternative}
allows for efficient numerical methods, since combinatorial equivalence for all $p\in Y$ implies that each vertex is defined by a fixed active set independently of $p$.
%
Sections~\ref{sec:computational:methods} and~\ref{sec:numerical:examples} illustrate how this property can be exploited computationally.
%

% In order to determine the Pontryagin difference between two sets one constructs the boundary of the Pontryagin difference. 
% %
% For this let $S = \{x\in\mathbb R^n:\Lambda_i x\leq \lambda_i,i\in\mathbb N_q\}$ and let $\mathcal W$ be defined by~\eqref{eq:definition:PWA:polytopic:set:general} satisfying Corollary~\ref{thm:p:convexity:PWA:set:constant:num:verts} and let $\mathcal W(x) = \conv_{i\in\mathbb N_v}\{v_i(x)\}\oplus\text{cone}_{i\in\mathbb N_r}\{r_i(x)\}$ be its V-representation.
% %
% Each inequality of $S$ must be satisfied for all admissible realisations $w\in\mathcal W(x)$ , that is:
% %
% \begin{equation*}\begin{split}
% 	\Lambda_i(x+w) &\overset{!}{\leq}\lambda_i\; \forall i\in\mathbb N_q, w\in\mathcal W(x)\\
% 	\Lambda_i x + \underbrace{\max_{w\in\mathcal W(x)} \Lambda_i w}_{(\dagger)} &\overset{!}{\leq} \lambda_i\; \forall i\in\mathbb N_q
% \end{split}\end{equation*}
% %
% The term~$(\dagger)$ is mpLP and its solution is attained on an extremal of~$\mathcal W(x)$, i.e. on one of the vertices or rays $v_i(x)$, $r_i(x)$.
% %
% Solving the mpLP is not necessary, due to Corollary~\ref{thm:combinatorical:equivalence:alternative} we know that every vertex and ray is generated by a fixed linear map~($a_i v_\kappa(x) = b_{i,k^\ast_i} + c_{i,k^\ast_i}x$ for~$i\in\mathcal A_\kappa$).
% %
% Therefore instead of solving~$(\dagger)$ we simply replace it with all possible vertices and rays and perform a regular inequality reduction:
% %
% \begin{equation*}
% 	S\ominus\mathcal W(S) = \{x\in\mathbb R^n : \Lambda_i (x + v_j/r_j(x) ) \leq \lambda_i \; \forall i\in\mathbb N_q,j\in\mathbb N_{v/r}\}.
% \end{equation*}
% %
% Since~$v_j(x)$ and~$r_j(x)$ are piecewise affine in~$x$, the set~$S\ominus\mathcal W(S)$ is a polyhedral set and has the description H-representation $S\ominus\mathcal W(S)=\{x\in\mathbb R^n:\Gamma_i x\leq \gamma_i\;i\in\mathbb N_u\}$.

\section{Computational Methods}\label{sec:computational:methods}
%
%
%
\subsection{Determination of Parametric Convexity}
%In the previous sections it was demonstrated that a set-valued
%map~$\mathcal W$ must be parametrically convex in order that the
%Pontryagin difference between any convex set $S$ and $\mathcal W$ is convex.
%
In Section~3 it was demonstrated that, in order for the
Pontryagin difference between any convex set $S$ and a set-valued
map~$\mathcal W$ to be convex, $\mathcal W$ must be parametrically
convex.
%
We have also seen that for a set-valued map with polyhedral realisations $\mathcal W(p)$, the number of vertices must not change throughout the parameter space~$Y$ in order that $\mathcal W(p)$ is parametrically convex.
%
Checking this condition may seem computationally challenging, however
we show in this section that it suffices to perform a finite number of calculations.
%
For notational convenience let $\phi_i(p) = \max_{k\in\mathbb N_q}\{b_{i,k}+c_{i,k}p\}$ denote the right hand side of~\eqref{eq:definition:PWA:polytopic:set:general}, i.e. $\mathcal W(p) = \{z\in\mathbb R^n: a_i z\leq \phi_i(p)\;\forall i\in\mathbb N_m\}$.
%
It is equivalent to study~$\phi_i$ and its \emph{epigraph} 
%
$$
	\epi(\phi_i) := \{(p,t)\in Y\times\mathbb R: \phi_i(p)\leq t\}
$$
%
see e.g.~\cite{Gorokhovik:1993}.
%
On each $d$-dimensional face 
%
\begin{equation}\label{eq:conv:hull:facet:of:epigraph}
F_j = \conv_f \left\{\left(\begin{array}{c}p_{j,f}\\ t_{j,f}\end{array}\right)\right\}
\end{equation}
%
of $\epi(\phi_i)$ there exists a maximiser~$k_j$ such that~$\phi_i$ is defined by~$\phi_i(p)=b_{i,k_j}+c_{i,k_j}p$ for all $p\in\pi_d(F_j)$ or equivalently~$\phi_i(p)=\sum_{f}\lambda_f t_{j,f}$ where the coefficients
$\lambda_f \in [0,1]$ satisfy 
% ${\bf{0}}\leq\lambda\leq{\bf{1}}$ 
$p=\sum_{f}\lambda_f p_{j,f}$ and $\sum_f\lambda=1$.
%
%Notice that we can write $\phi_i(p)$ as a convex combination of points even if~\eqref{eq:conv:hull:facet:of:epigraph} is redundant (i.e.~if not every point in the convex combination on the rhs of~\eqref{eq:conv:hull:facet:of:epigraph} is a vertex of $F_j$).

Let~$\mathcal C$ be a polyhedral complex such that in each $d$-dimensional element~$\mathcal P_j\in\mathcal C$ the set-valued map is given by $\mathcal W(p) = \{z\in\mathbb R^n:a_i z\leq b_{i,k_j} + c_{i,k_j} p\}$. 
%
It is worth pointing out that any such polyhedral complex is not assumed to be minimal, since the minimal complex could have non-convex elements, those elements can however be partitioned so that every element of the non-minimal $\mathcal C$ is a convex polyhedron. 
%
A natural way to obtain a convex polyhedral complex is by projecting the facets of the set
%
\[%\begin{equation}
  E :=\left\{(p,t_1,\dots,t_m)\in Y\times\mathbb R^{m}:\phi_i(p)\leq t_i\right\}
\]%\end{equation}
%
onto $\mathbb R^d$.
%
The set of vertices of elements in the complex coincides with the union of all vertices of $d$-dimensional faces of $\epi(\phi_i)$ for all $i\in\mathbb N_m$, i.e.
%
$$\begin{aligned}
	\bigcup_{{P}\in\mathcal C}\vertices({P}) = \bigcup_{(\ast)} \vertices(\pi_d(F)) = \bigcup_{i\in\mathbb N_m}\pi_d(\vertices(\epi(\phi_i))),
\end{aligned}$$
%
with $(\ast) = \{F: F $ is a $d$-dimensional face of $\epi(d_i)$ for some $i\in\mathbb N_m\}$.
%
It is now obvious that the graph $\mathscr G(\mathcal W)\vert_{\mathcal P_j}$ on each $d$-dimensional element $\mathcal P_j\in\mathcal C$ is entirely defined by the values of $\mathcal W(p_j)$ at the vertices $p_j\in\vertices(\mathcal P_j)$.
%
In each~$\mathcal P_j$ we have $\mathcal W(p) = \{z: a_i z\leq \sum_f \lambda_f t_{i,j,f}, \sum_f\lambda_f p_{j,f}=p, \sum_f\lambda=1, \lambda_f\in[0,1]\; \forall i\in\mathbb N_m\}$
%
Therefore, if~$\mathcal A\subset\mathbb N_m$ such that~$\abs{\mathcal A}=d$ and $a_i v = t_{i,j}$ $\forall i\in\mathcal A$ defines a vertex $v$ of $\mathcal W(p_j)$, then $a_i v = \sum_f \lambda_f t_{i,f}$ $\forall i \in \mathcal A$ defines a vertex $v$ of $\mathcal W(p)$.

The proposed algorithm to determine parametric convexity of a given piecewise affine polyhedral description~$\mathcal W(p)$ as in~\eqref{eq:definition:PWA:polytopic:set:general} can be summarised as follows:
%
First, compute all vertices~$\vertices(E)$.
%
Next, check whether the number of vertices is constant on $\mathcal D = \pi_d\left(\vertices(E)\right)$, i.e. 
%
$$\abs{\vertices(\mathcal W(p))} = c_{\mathcal D} \ \ \forall p\in\mathcal D$$
%
for some constant $c_{\mathcal D}$. If this is the case, then
Theorem~\ref{thm:p:convexity:PWA:set:constant:num:verts} holds and
$\mathcal W(p)$ is parametrically convex. Furthermore, enumerating the vertices of $\mathcal W(p)$ for any fixed $p\in Y$ yields all vertices defining active sets $\mathcal A\subset\mathbb N_m$ which remain unchanged for all $p\in Y$ according to Corollary~\ref{thm:combinatorical:equivalence:alternative}.
%
\subsection{Computing the Parametric Pontryagin Difference}\label{ssec:computation:p:pontryagin:difference}
%
%
%
The constancy of the active inequalities defining vertices of~$\mathcal W(p)$ is particularly useful when we compute the parametric Pontryagin difference $S\ominus\mathcal W(S)$.
%
In particular, for the set $S=\{p\in\mathbb R^d:\Lambda_i p\leq\lambda_i \, \forall i\in\mathbb N_q\}$ each facet $P_i=\{p:\Lambda_i p=\lambda_i \wedge \Lambda_j p\leq\lambda_j \, \forall j\neq i\}$ can be used to determine facets of the set difference.
%
Namely each point~$p$ on the boundary of $S\ominus\mathcal W(S)$ is such that there exists $w^\ast\in\mathcal W(p)$ so that $p+w^\ast$ lies on the boundary of $S$.
%
Computing the set $S\ominus\mathcal W(S)$ therefore reduces to computing points~$p$ for which $w^\ast\in\mathcal W(p)$ exists to produce~$p+w^\ast\in P_i$ for some $i\in\mathbb N_q$.
%
In order to find such points we use the inequalities:
%
\[%\begin{equation}
\begin{split}
  \Lambda_i(p+w)\leq\lambda_i\ \forall w\in\mathcal W(p)\\
  \Lambda_i p+\underbrace{\max_{w\in\mathcal W(p)}\Lambda_i w}_{(\dagger)}\leq\lambda_i
\end{split}
\]%\end{equation}
%
The term~$(\dagger)$ is a mpLP, however we are less interested in the
objective value of~$(\dagger)$ than the \revision{dependence of its solution
on~$p$}, since this defines the set of points 
that can only just be taken to $P_i$ for an extremal value of $w\in\mathcal W(p)$ and thus form the boundary of $S\ominus \mathcal W(S)$.
%
We exploit the linearity of the objective function to argue that only vertices of~$\mathcal W(p)$ are candidates to be the maximiser in~$(\dagger)$.
%
According to Corollary~\ref{thm:combinatorical:equivalence:alternative} there exists a fixed map~$T$ such that 
%
\[%\begin{equation}
  \begin{pmatrix}w_1\\ \vdots\\ w_N\end{pmatrix} = \underbrace{\begin{pmatrix}T_1\\ \vdots\\ T_N\end{pmatrix}}_T t(p)
\]%\end{equation}
%
defines all vertices of $\mathcal W(p) = \conv\bigl\{w_1(t(p)),\dots,w_N(t(p))\bigr\}$ for an elementwise convex piecewise affine function $t(p)$.
%
It is easy to see that the choice $t_i(p)=\phi_i(p)$ again leads us to the epigraph~$\epi(\phi_i)$ and therefore that the maximisation~$(\dagger)$ becomes
%
\begin{equation}\label{eq:rewriting:pontryagin:diff:without:facet:constraint}
  \max_{w\in\mathcal W(p)}\Lambda_i w = \left\{\begin{array}{rl}
  \min& \tau\\
  \text{s.t.}& \Lambda_iT_jt\leq\tau\\
  & B_k+C_k p \leq t_k\\
  & j\in\mathbb N_N, \ k\in\mathbb N_m 
  \end{array}\right.
\end{equation}
%
Furthermore the solution to~\eqref{eq:rewriting:pontryagin:diff:without:facet:constraint} is only relevant for such~$p$ that can be taken to~$P_i$ for some $i\in\mathbb N_q$.
%
By including this constraint in~\eqref{eq:rewriting:pontryagin:diff:without:facet:constraint}, we obtain a linear program that is only feasible on the points which can be taken to $P_i$ for $w\in\mathcal W(p)$:
%
\begin{equation}\label{eq:rewriting:pontryagin:diff:with:facet:constraint}
  \begin{array}{rl}
  \min& \tau\\
  \text{s.t.}& \Lambda_iT_jt\leq\tau\\
  & B_k+C_k p\leq t_k\\
  &\Lambda_i p + \tau=\lambda_i\\
  &\Lambda_l(p + T_jt)\leq\lambda_l\\
  &l\neq i, \ j\in\mathbb N_N, \ k\in\mathbb N_m 
  \end{array}
\end{equation}
%
Notice that we are only interested in the feasible~$p$ rather than the objective value of~\eqref{eq:rewriting:pontryagin:diff:with:facet:constraint}, i.e. $p$ such that there exist $t$ and $\tau$ such that 
%
\[%\begin{equation}
  (p,t,\tau)\in\tilde P_i :=\left\{(p,t,\tau):\begin{array}{rcl}
  \Lambda_iT_jt&\leq&\tau\\
  B_k+C_k p&\leq& t_k\\
  \Lambda_i p + \tau&=&\lambda_i\\
  \Lambda_l(p + T_jt)&\leq&\lambda_l\\
  \end{array},\begin{array}{l}
   l\neq i\\
   j\in\mathbb N_N\\
   k\in\mathbb N_m
   \end{array}
   \right\}
\]%\end{equation}
%
%but this is the definition of the projection onto $\mathbb R^d$.
%
Therefore the boundary of $S\ominus \mathcal W(S)$ can be expressed as the union of projections:
%
\begin{equation}\label{eq:boundary:S:ominus:WS}
 \partial(S\ominus\mathcal W(S)) = \bigcup_{i\in\{1,\dots,q\}}\pi_d\left(
\tilde P_i
 \right)
\end{equation}
%
The simplest way to use~\eqref{eq:boundary:S:ominus:WS} is through a vertex description of $\tilde P_i$:
%
\begin{equation}\label{the:way:we:compute:p:pontryagin:differences}
  \vertices(S\ominus\mathcal W(S)) =
  \bigcup_{i\in\{1,\dots,q\}}\pi_d(\vertices(\tilde P_i)) .
\end{equation}

We conclude this section by proposing an alternative way of computing $S\ominus\mathcal W(S)$.
%
%Instead of using~$\tilde P_i$, which consists of points~$p$ that can be taken
%to $P_i$ for a feasible $w\in\mathcal W(p)$, and the values of
%$\phi_i(p)$, 
%we obtain all feasible~$p$ such that a feasible $w\in\mathcal W(p)$
%exists such that $p+w$ lies on the boundary of $S$.
%
%To directly obtain all feasible~$p$ such that a feasible $w\in\mathcal W(p)$
%exists such that $p+w$ lies on the boundary of $S$, c
Consider the set
%
\[%\begin{equation}
  L := \left\{(p,t,\tau):\begin{array}{rcl}
  \Lambda_iT_jt&\leq&\tau_i\\
  B_k+C_k p&\leq& t_k\\
  \Lambda_i p + \tau_i&\leq&\lambda_i\\
  \end{array},\begin{array}{l}
  j\in\mathbb N_N\\
  k\in\mathbb N_m\\
  i\in\mathbb N_q\end{array}
  \right\} .
\]%\end{equation}
%
This set contains all points $p$ for which there exists $w\in\mathcal W(p)$ such that $p+w\in S$ and hence $\pi_d(L)=S\ominus\mathcal W(S)$, which does not require a vertex enumeration.
%
Notice that although both of the methods described in this section
provide the same result, the first method requires the vertex
enumeration of $q$ $(d + m + 1)$-dimensional polyhedrons, whereas the
latter requires the projection of a $(d + m + q)$-dimensional polyhedron
onto $\mathbb R^d$. Depending on the complexity of $S$, the appropriate method may be chosen.
%
%
%
%
\section{Numerical Examples}\label{sec:numerical:examples}
\subsection{Norm-bound sets}\label{ssec:example:one}
%
Consider the set~$X = \{x\in\mathbb R^2: \abs{x_1}\leq 1\wedge \abs{x_2}\leq 1\}$ and the set-valued map $\mathcal W(x) = \{w\in\mathbb R^2: \norm{w}_P\leq\kappa\norm{x}_P\}$.
%
Where $\norm{\cdot}_P$ is a polytopic approximation to the euclidean norm~$\norm{\cdot}_2$, i.e.
%
$$
c_1 \norm{x}_P\leq\norm{x}_2\leq c_2\norm{x}_P.
$$
%
For example
%
$$\begin{aligned}
\norm{x}_P &= \max_{k\leq n}\left\{\sin\left(\frac{2\pi}{n-1}k\right) x_1 + \cos\left(\frac{2\pi}{n-1}k\right) x_2\right\} = \max_{k\leq n}\{F_k x\}.
\end{aligned}$$
%
For this choice we find $c_1 = \cos\left(\frac{\pi}{n-1}\right)$ and $c_2=1$.
%
Here~$\mathcal W(x)$ is a scaled approximation of an euclidean ball and therefore obviously parametrically convex with a fixed combinatorial structure.
%
In fact the~$n$ vertices of $\mathcal W(x)$ are  given by the solution of
%
$$
  \left(\begin{array}{cc}
  \sin\left(\frac{2\pi}{n-1}(k-1)\right) & \cos\left(\frac{2\pi}{n-1}(k-1)\right) \\
  \sin\left(\frac{2\pi}{n-1}k\right) & \cos\left(\frac{2\pi}{n-1}k\right)
  \end{array}
  \right) w_k = {\bf{1}}\norm{x}_P
$$
%
for $k=1,\dots,n$.

In order to apply the method described in Section~\ref{ssec:computation:p:pontryagin:difference} we require a map $T$ such that 
%
$$
\begin{pmatrix}
w_1\\ \vdots \\ w_n
\end{pmatrix} = \begin{pmatrix}T_1\\\vdots\\T_n\end{pmatrix}{\bf{1}}t(x).
$$
%
holds, and this becomes trivial as $t=\max_{k\leq n} \{F_kx\}$ is a scalar.
% 
The sets $\tilde P_i$ and $L$ are then given by
%
% Characterising the parametric Pontryagin difference~$X\ominus\mathcal W(X) = \{z\in\mathbb R^2:z+w\in X\;\forall w\in\mathcal W(z)\}$ is done by characterising its boundary.
% %
% This is done by finding points~$z$ which for some~$w\in\mathcal W(z)$ can be taken to the boundary of $X$.
% %
% For the face given by $P_i = \{x:\Lambda_i x=\lambda_i\wedge\Lambda_j x\leq \lambda_j,j\neq i\}$, we find the face(s) of $X\ominus\mathcal W(X)$ by finding extremal values of $w\in\mathcal W(P_i)$ defining it, i.e. the extremal values of
% %
% $$
%   \Lambda_i(z+w)=\lambda_i\; w\in\mathcal W(z)\wedge \Lambda_j(z+w)\leq\lambda_j,j\neq i.
% $$
% %
% To do this, we rewrite the problem as a maximisation
% %
% $$
% \begin{array}{rl}\max& \Lambda_i w \\ \text{s.t.}& w\in\mathcal W(z)\\ &\Lambda_i (z + w) = \lambda_i\\
% &\Lambda_j(z+w)\leq \lambda_j\end{array}
% $$
% %
% We now exploit the fact that we have a vertex description of the set-valued map $\mathcal W(x) = \bigl\{w:F w\leq{\bf{1}}\max_{k\leq n}\{F_kx\}\bigr\}$ and with the auxiliary variable~$\max_{k\leq n}\{F_k x\} = t$ we rewrite $\mathcal W(x) = \conv\{w_i(t(x))\}$ using the vertices
% %
% $$
% \begin{pmatrix}
% w_1\\ \vdots \\ w_n
% \end{pmatrix} = \begin{pmatrix}T_1\\\vdots\\T_n\end{pmatrix}{\bf{1}}t(x).
% $$
% %
% With this the set of points for which there exists a feasible $w\in\mathcal W$ reaching the face $P_i$ is given as the projection
% %
$$
\tilde P_i= \left\{(z,t,\tau): \begin{array}{rcl}\kappa\Lambda_i Tt &\leq& \tau\\ Fz&\leq& t\\ \Lambda_i(z+\tau)&=&\lambda_i\\ \Lambda_j(z+\kappa T_lt)&\leq&\lambda_j\end{array},j\neq i,l\in\mathbb N_n\right\}
$$
%
and
% %
% This then gives us all points $z$ for which a feasible $w$ can be found such that $z+w\in P_i$, by combining all such projections we obtain the representation of $X\ominus\mathcal W(X)$.
% %
% Alternatively, the set~$X\ominus\mathcal W(X)$ can be obtained by a single projection of the higher dimensional set:
$$
L = \left\{(z,t,\tau_1,\dots,\tau_q):\begin{array}{rcl}
\kappa\Lambda_i Tt & \leq &\tau_i\\
Fz &\leq& t\\
\Lambda_i(z+\tau_i)&\leq&\lambda_i
\end{array},i\in\mathbb N_q\right\}
$$
% %
% However, in practical application the increase in computation time of projecting a $d+q+1$ polyhedron onto $d$ instead of projecting a $d+2$ polyhedron onto $d$ $q$ times is usually prohibitively large.
%
respectively.

For the choice~$\kappa=0.2$ and~$n = 35$ the set~$X\ominus\mathcal W(X)=\pi_2(L)=$\linebreak $\conv\{\cup_{i\in\{1,\dots,4\}}\pi_2(\vertices(\tilde P_i)\}$ is illustrated in Figure~\ref{fig:example:parametric:pontryagin:difference}.

\begin{figure}[h]
\centering
% \includegraphics[width=.95\columnwidth]{parametricPD.pdf}
\begin{tikzpicture}[scale=3]
\draw[step=.25,gray,very thin] ( -1,  -1) grid (  1,   1);
\foreach \x in {-1,-0.5,...,1} \draw (\x,-1) node[below] {$\x$};
\foreach \y in {-1,-0.5,...,1} \draw (-1,\y) node[left] {$\y$};
\draw[thick,blue] (  0.0772,   0.8327) -- ( -0.0772,   0.8327) -- ( -0.2355,   0.8279) -- ( -0.4070,   0.8174) -- ( -0.6038,   0.7996) -- ( -0.7790,   0.7790) -- ( -0.7870,   0.7175) -- ( -0.8096,   0.5013) -- ( -0.8234,   0.3190) -- ( -0.8309,   0.1553) -- ( -0.8333,   0.0000) -- ( -0.8309,  -0.1553) -- ( -0.8234,  -0.3190) -- ( -0.8096,  -0.5013) -- ( -0.7870,  -0.7175) -- ( -0.7790,  -0.7790) -- ( -0.6038,  -0.7996) -- ( -0.4070,  -0.8174) -- ( -0.2355,  -0.8279) -- ( -0.0772,  -0.8327) -- (  0.0772,  -0.8327) -- (  0.2355,  -0.8279) -- (  0.4070,  -0.8174) -- (  0.6038,  -0.7996) -- (  0.7790,  -0.7790) -- (  0.7870,  -0.7175) -- (  0.8096,  -0.5013) -- (  0.8234,  -0.3190) -- (  0.8309,  -0.1553) -- (  0.8333,   0.0000) -- (  0.8309,   0.1553) -- (  0.8234,   0.3190) -- (  0.8096,   0.5013) -- (  0.7870,   0.7175) -- (  0.7790,   0.7790) -- (  0.6038,   0.7996) -- (  0.4070,   0.8174) -- (  0.2355,   0.8279) -- (  0.0772,   0.8327) -- cycle;
\draw[-latex'] (-1,-1) -- (1.1,-1) node[above] {\small{$z_1$}};
\draw[-latex'] (-1,-1) -- (-1,1.1) node[right] {\small{$z_2$}};
\end{tikzpicture}
\caption{$X\ominus\mathcal W(X)$ for Example~\ref{ssec:example:one}.}
\label{fig:example:parametric:pontryagin:difference}
\end{figure}


\subsection{Elementwise-bound sets}\label{exp:second:example}
%
For another example we take inspiration from a robust control scenario.
%
We want to approximate the maximal positive invariant set for a system of the type
\begin{equation}\label{eq:nonlinear_system}
x^+=Ax + f(x),
\end{equation}
(where $x$ denotes the system state and $x^+$ the successor state)
for $x\in\mathcal X$, i.e. the largest set of points~$\mathcal X^\infty\subseteq\mathcal X$ such that $x\in\mathcal X^\infty$ implies $x^+\in\mathcal X^\infty$, see e.g.~\cite{blanchini:2007}.
%

For general nonlinear systems~$x^+=Ax + f(x)$ the maximal positive invariant set cannot be calculated, but assuming piecewise affine bounds on the nonlinearity,
\[
\min_{k\leq M_i}\{h_{i,k}^x x + h_{i,k}^c\}\leq f_i(x)\leq\max_{k\leq N_i}\{H_{i,k}^x x + H_{i,k}^c\}
\] 
for all $x\in\mathcal X$ and each element of~$f(x)$,
%
we can study the system $x^+=Ax+w$ with 
\[
w\in\mathcal W(x) = \Bigl\{w:\min_{k\leq M_i}\{h_{i,k}^x x + h_{i,k}^c\}\leq w_i\leq\max_{k\leq N_i}\{H_{i,k}^x x + H_{i,k}^c\}\,\forall i\in\mathbb N_d\Bigr\}.
\]
%
To bound the maximal positive invariant set of the system~(\ref{eq:nonlinear_system}) we compute the maximal robust positive invariant set for the perturbed linear system $x^+=Ax+w$, i.e. the set of states~$\mathscr X^\infty\subseteq\mathcal X$ such that $x\in\mathscr X^\infty$ implies $x^+\in\mathscr X^\infty$ for all possible $w\in\mathcal W(x)$.
%
The algorithm to determine the maximal robust positive invariant sets recursively intersects the current set iterate~$X_l$ with the set of all possible successor states starting from the current iterate, so that $X_{l+1}=X_l\cap\left\{\bigcup_{x\in X_l,w\in\mathcal W(x)}\{Ax+w\}\right\}$.
%
We illustrate the procedure by describing a single iteration of the algorithm.
%
% Notice that for a constant set-valued map~$\mathcal W(x) = \mathcal W$ the iteration can be summarised as $X_{l+1} = X_l\cap A^{-1}(X_l\ominus\mathcal W)$, for a set valued map a similar compact notation also holds, however it is more confusing than helpful:~$X_{l+1}=X_l\cap(A^{-1}X_l\ominus A^{-1}\mathcal W(A^{-1}X_l))$.

To demonstrate the proposed treatment of the nonlinearities we use the two-dimensional system~$x^+=x+f(x)$, where the nonlinearity is given by $f = [f_1 \ \ f_2]^\top$,
%
%\begin{subequations}
\begin{align*}
  f_1(x) &= \frac{1}{10}\left(\frac{x_1}{2}+x_2\right)^3 \\
  f_2(x) &= \frac{1}{2}\arcsin\left(g_1\left(x_1-\frac{x_2}{2}\right)+g_2\left(x_1-\frac{x_2}{2}\right) \right)
\end{align*}
%\end{subequations}
%
with $g_1(t)=\sigma(t)\sqrt{\frac{t}{2}}$, $g_2(t)=\sigma(-t)\frac{t}{2}$ where $\sigma(t)$ denotes the Heaviside function.
%\sigma\left(x_1-\frac{x_2}{2}\right)\sqrt{\frac{x_1-\frac{x_2}{2}}{2}} + \sigma\left(-\left(x_1-\frac{x_2}{2}\right)\right)\frac{x_1-\frac{x_2}{2}}{2}
\[
  \sigma(t) = \begin{cases} 1 & t \geq 0 \\ 0 & t < 0 \end{cases}
%\left\{\begin{array}{crcl}1& t&\geq&0\\ 0 &t&<&0 \end{array}\right.
\]
%
As the constraint set we use $X_l = \{x:\abs{x_1}+\abs{x_2}\leq 2\}$.
%
We use piecewise affine approximations of $f_1(x)$~(Figure~\ref{fig:approximation:f1:p:diff}) and~$f_2(x)$ (Figure~\ref{fig:approximation:f2:p:diff})
% In order not to bore the reader with numerical values, we illustrate the approximation of $f_1(x)$ in Figure~\ref{fig:approximation:f1:p:diff} and~$f_2(x)$ in Figure~\ref{fig:approximation:f2:p:diff}, 
for both we obtain upper and lower bounds using secants and tangents.
%
Figure~\ref{fig:approximation:f2:p:diff} shows an obvious weakness of the approach:~$\max_k\{c_k x+b_k\}$ is necessarily convex, therefore approximating non-convex functions introduces conservativeness.

The computation of the set~$X_{l+1}$ is then done analogously to the previous example, again we use 
%
$$
  \mathcal W(x) = \conv\left\{\begin{pmatrix}t_1\\ t_3\end{pmatrix},\begin{pmatrix}t_1\\ t_4\end{pmatrix},
  \begin{pmatrix} t_2\\ t_3\end{pmatrix},\begin{pmatrix}t_2\\ t_4\end{pmatrix}
  \right\}
$$
%
with $t_1=\max_k\{H_{1,k}^x x+H_{1,k}^c\}$, $t_3=\max_k\{H_{2,k}^x x+H_{2,k}^c\}$, $t_2={-\max_k}\{-h_{1,k}^x x-h_{1,k}^c\}$ and $t_4={-\max_k}\{-h_{1,k}^x x-h_{1,k}^c\}$.
%
Each facet~$P_i=\{x:\Lambda_i x=\lambda_i\wedge\Lambda_jx\leq\lambda_j,j\neq i\}$ of the current set iterate defines facets of the next set iterate satisfying
%
\begin{equation}
\Lambda_i(Ax+w^\ast)=\lambda_i, \quad \Lambda_j(Ax+w^\ast)\leq\lambda_j \ \forall j\neq i ,
\end{equation}
%
where $w^\ast$ is the maximiser of the defining mpLP $\max_{w\in\mathcal W(x)}\Lambda_iw$, i.e.~one of the vertices defined by
%
$$
  \begin{pmatrix} w_1\\ \vdots \\ w_N\end{pmatrix}= Tt.
$$
%
The collection of facets generated by~$P_i$ is then given by the projection
%
\begin{equation}
  \pi_d\left(\left\{(x,t,\tau):\begin{array}{rcl}
  \Lambda_iAx+\tau&=&\lambda_i\\
  \Lambda_i T_lt&\leq&\tau\\
  \Lambda_j(Ax+T_lt)&\leq&\lambda_j\\
  H_l^x x + H_l^c&\leq&t_{2l-1}\\
  -h_l^x x - h_l^c&\leq&t_{2l}
  \end{array}, \begin{array}{l}
  j\neq i\\
  l\in\mathbb N_d\end{array}
  \right\}\right)
\end{equation}
%
Analogously to the previous example, rather than computing~$q$ projections from $\mathbb R^{3d+1}$ onto $\mathbb R^d$, we can perform a single projection with the same result:
%
\begin{equation}
  \pi_d\left(\left\{(x,t,\tau):\begin{array}{rcl}
  \Lambda_i T_lt&\leq&\tau_i\\
  \Lambda_iAx+\tau_i&\leq&\lambda_i\\
  H_l^x x + H_l^c&\leq&t_{2l-1}\\
  -h_l^x x - h_l^c&\leq&t_{2l}
  \end{array}, \begin{array}{l}
  i\in\mathbb N_q,\\
  l\in\mathbb N_d\end{array}
  \right\}\right)
\end{equation}
%
The resulting set for this two-dimensional example is illustrated in Figure~\ref{fig:second:example:resulting:set}.


\begin{figure}
\centering
\begin{tikzpicture}[scale=1.8]
\draw[-latex'] (-2.1,0) -- (2.1,0) node[above] {$t$};
\draw[-latex'] (0,-.9) -- (0,.9) node[right,blue] {$f_1(t)$};
\foreach \x in {-2,-1.5556,...,2} \draw (\x,0.05) -- (\x,-.05);
\draw (-2,-.05) node[below] {$-2$};
\draw (2,-.05) node[below] {$2$};
\foreach \y in {-.8,-.4,...,.8} \draw (0.05,\y) -- (-.05,\y);
\draw (.05,-.8) node[right] {$-0.8$};
\draw (.05,-.4) node[right] {$-0.4$};
\draw[scale=1,domain=-2:2,smooth,variable=\x,blue] plot ({\x},{\x*\x*\x/10});
\draw (-2.0000, -0.8000) -- (-1.5556, -0.3764) -- (-1.1111, -0.1372) -- (-0.6667, -0.0296) -- (-0.2222, -0.0011) -- (0,0); 
\draw (0,0) -- (0.2222, 0.0011) -- (0.6667, 0.0296) -- (1.1111, 0.1372) -- (1.5556, 0.3764) -- (2.0000, 0.8000);
\fill[pattern = north east lines, opacity=.5] (-2.0000, -0.8000) -- (-1.5556, -0.3764) -- (-1.1111, -0.1372) -- (-0.6667, -0.0296) -- (-0.2222, -0.0011) -- (0,0) -- (-2,0) -- cycle; 
\fill[pattern = north east lines, opacity=.5] (0,0) -- (0.2222, 0.0011) -- (0.6667, 0.0296) -- (1.1111, 0.1372) -- (1.5556, 0.3764) -- (2.0000, 0.8000) -- (2,0) -- cycle;
\end{tikzpicture}
\caption{$f_1(t)$, for $t=\frac{x_1}{2}+x_2$, and its approximation by 9 secants used in Example~\ref{exp:second:example}.}
\label{fig:approximation:f1:p:diff}
\end{figure}

\begin{figure}
\centering
\begin{tikzpicture}[scale=1.8]
\draw[-latex'] (-2.1,0) -- (2.1,0) node[above] {$t$};
\draw[-latex'] (0,-.9) -- (0,.9) node[right,blue] {$f_2(t)$};
\foreach \x in {-2,-1.5556,...,2} \draw (\x,0.05) -- (\x,-.05);
\draw (-2,-.05) node[below] {$-2$};
\draw (2,-.05) node[below] {$2$};
\foreach \y in {-.8,-.4,...,.8} \draw (0.05,\y) -- (-.05,\y);
\draw (.05,-.8) node[right] {$-0.8$};
\draw (.05,-.4) node[right] {$-0.4$};
\draw[blue] (-2.0000, -0.7854) -- (-1.9596, -0.6847) -- (-1.9192, -0.6428) -- (-1.8788, -0.6104) -- (-1.8384, -0.5830) -- (-1.7980, -0.5587) -- (-1.7576, -0.5367) -- (-1.7172, -0.5163) -- (-1.6768, -0.4972) -- (-1.6364, -0.4791) -- (-1.5960, -0.4620) -- (-1.5556, -0.4456) -- (-1.5152, -0.4298) -- (-1.4747, -0.4146) -- (-1.4343, -0.3999) -- (-1.3939, -0.3856) -- (-1.3535, -0.3717) -- (-1.3131, -0.3581) -- (-1.2727, -0.3449) -- (-1.2323, -0.3319) -- (-1.1919, -0.3192) -- (-1.1515, -0.3068) -- (-1.1111, -0.2945) -- (-1.0707, -0.2825) -- (-1.0303, -0.2706) -- (-0.9899, -0.2589) -- (-0.9495, -0.2473) -- (-0.9091, -0.2359) -- (-0.8687, -0.2247) -- (-0.8283, -0.2135) -- (-0.7879, -0.2025) -- (-0.7475, -0.1915) -- (-0.7071, -0.1807) -- (-0.6667, -0.1699) -- (-0.6263, -0.1592) -- (-0.5859, -0.1486) -- (-0.5455, -0.1381) -- (-0.5051, -0.1276) -- (-0.4646, -0.1172) -- (-0.4242, -0.1069) -- (-0.3838, -0.0966) -- (-0.3434, -0.0863) -- (-0.3030, -0.0761) -- (-0.2626, -0.0658) -- (-0.2222, -0.0557) -- (-0.1818, -0.0455) -- (-0.1414, -0.0354) -- (-0.1010, -0.0253) -- (-0.0606, -0.0152) -- (-0.0202, -0.0051) -- ( 0.0202,  0.0503) -- ( 0.0606,  0.0875) -- ( 0.1010,  0.1133) -- ( 0.1414,  0.1346) -- ( 0.1818,  0.1531) -- ( 0.2222,  0.1699) -- ( 0.2626,  0.1854) -- ( 0.3030,  0.1999) -- ( 0.3434,  0.2136) -- ( 0.3838,  0.2267) -- ( 0.4242,  0.2393) -- ( 0.4646,  0.2515) -- ( 0.5051,  0.2633) -- ( 0.5455,  0.2747) -- ( 0.5859,  0.2859) -- ( 0.6263,  0.2969) -- ( 0.6667,  0.3077) -- ( 0.7071,  0.3184) -- ( 0.7475,  0.3289) -- ( 0.7879,  0.3393) -- ( 0.8283,  0.3496) -- ( 0.8687,  0.3598) -- ( 0.9091,  0.3699) -- ( 0.9495,  0.3801) -- ( 0.9899,  0.3902) -- ( 1.0303,  0.4003) -- ( 1.0707,  0.4104) -- ( 1.1111,  0.4205) -- ( 1.1515,  0.4307) -- ( 1.1919,  0.4410) -- ( 1.2323,  0.4513) -- ( 1.2727,  0.4618) -- ( 1.3131,  0.4723) -- ( 1.3535,  0.4830) -- ( 1.3939,  0.4939) -- ( 1.4343,  0.5050) -- ( 1.4747,  0.5164) -- ( 1.5152,  0.5280) -- ( 1.5556,  0.5400) -- ( 1.5960,  0.5523) -- ( 1.6364,  0.5651) -- ( 1.6768,  0.5785) -- ( 1.7172,  0.5926) -- ( 1.7576,  0.6076) -- ( 1.7980,  0.6237) -- ( 1.8384,  0.6413) -- ( 1.8788,  0.6610) -- ( 1.9192,  0.6842) -- ( 1.9596,  0.7141) -- ( 2.0000,  0.7854);
\draw (-2.0000, -0.7854) -- (-1.8000, -0.5599) -- (-1.5000, -0.4240) -- (0, 0);
\fill[pattern = north east lines, opacity=.5] (-2.0000, -0.7854) -- (-1.8000, -0.5599) -- (-1.5000, -0.4240) -- (0, 0) -- (-2,0) -- cycle;
\draw (-.5466,0) -- (0.7000, 0.3165) -- (1.0000, 0.3927) -- (1.5000, 0.5236) -- (1.7000, 0.5865) -- (2.0000, 0.7854);
\fill[pattern = north east lines, opacity=.5] (-.5466,0) -- (0.7000, 0.3165) -- (1.0000, 0.3927) -- (1.5000, 0.5236) -- (1.7000, 0.5865) -- (2.0000, 0.7854) -- (2,0) -- cycle;
\end{tikzpicture}
\caption{$f_2(t)$, for $t=x_1-\frac{x_2}{2}$, and its approximation by 5 secants and 4 tangents as used in Example~\ref{exp:second:example}.}
\label{fig:approximation:f2:p:diff}
\end{figure}

\begin{figure}
\centering
\begin{tikzpicture}[scale=1.8]
\draw[step=.5,gray,very thin] (-2,-2) grid (2,2);
\foreach \x in {-2,-1.5,...,2} \draw (\x,-2) node[below] {$\x$};
\foreach \y in {-2,-1.5,...,2} \draw (-2,\y) node[left] {$\y$};
\draw[-latex'] (-2,-2) -- (2.2,-2) node[above] {$x_1$};
\draw[-latex'] (-2,-2) -- (-2,2.2) node[right] {$x_2$};
\draw[blue,thick] ( -0.2333,   1.7667) -- ( -1.3333,   0.6667) -- ( -1.4807,   0.5182) -- ( -1.6815,   0.2968) -- ( -1.6720,   0.2560) -- ( -1.6039,   0.1353) -- ( -1.5073,  -0.0145) -- ( -1.0649,  -0.5786) -- ( -0.5663,  -1.1326) -- ( -0.1361,  -1.4875) -- (  0.2333,  -1.7667) -- (  1.3333,  -0.6667) -- (  1.4807,  -0.5182) -- (  1.6499,  -0.3316) -- (  1.5962,  -0.2075) -- (  1.5190,  -0.0928) -- (  1.4796,  -0.0407) -- (  1.1714,   0.3429) -- (  0.9224,   0.6499) -- (  0.1793,   1.4518) -- (  0.1361,   1.4875) -- ( -0.2333,   1.7667) -- cycle;
\draw[red] (  2.0000,   0.0000) -- (  0.0000,   2.0000) -- ( -2.0000,  -0.0000) -- ( -0.0000,  -2.0000) -- (  2.0000,   0.0000) -- cycle;
\foreach \x/\y in { -0.2333/  1.7667,  0.1361/  1.4875,  0.1793/  1.4518, -1.3333/  0.6667, -1.0649/ -0.5786, -1.5073/ -0.0145, -1.6039/  0.1353,  0.9224/  0.6499,  1.6499/ -0.3316,  1.4807/ -0.5182,  1.5962/ -0.2075,  1.4796/ -0.0407,  1.5190/ -0.0928,  1.3333/ -0.6667,  1.1714/  0.3429,  0.2333/ -1.7667, -0.1361/ -1.4875, -0.5663/ -1.1326, -1.6720/  0.2560, -1.6815/  0.2968, -1.4807/  0.5182} \draw[green!80!black] (\x,\y) circle (.75pt);
\foreach \x/\y in {  0.2160/  1.4706,  0.5125/  1.3332,  0.5456/  1.3134, -1.3333/  0.1741, -1.2021/ -0.7778, -1.5526/ -0.4386, -1.6336/ -0.3595,  1.0596/  0.9390,  1.6619/  0.2996,  1.4818/  0.0827,  1.6168/  0.3790,  1.5138/  0.4829,  1.5486/  0.4501,  1.3333/ -0.0915,  1.2515/  0.7356, -0.2160/ -1.3448, -0.5125/ -1.1956, -0.8500/ -1.1326, -1.6915/ -0.3039, -1.6976/ -0.2809, -1.4818/ -0.0094} \draw[yshift=-.5pt,xshift=-.5pt,magenta] (\x,\y) rectangle ++(1pt,1pt);
% \foreach \x/\y in {0.2333/  1.7667,  0.2333/  1.4511, -0.2333/  1.7667, -0.2333/  1.4511,  0.5125/  1.4875,  0.5125/  1.3157,  0.1361/  1.4875,  0.1361/  1.3157,  0.5482/  1.4518,  0.5482/  1.2973,  0.1793/  1.4518,  0.1793/  1.2973, -1.3333/  0.6667, -1.3333/  0.1672, -1.3333/  0.6667, -1.3333/  0.1672, -1.0649/ -0.5786, -1.0649/ -0.7979, -1.2021/ -0.5786, -1.2021/ -0.7979, -1.5073/ -0.0145, -1.5073/ -0.4386, -1.5614/ -0.0145, -1.5614/ -0.4386, -1.6039/  0.1353, -1.6039/ -0.3664, -1.6336/  0.1353, -1.6336/ -0.3664,  1.0596/  0.9404,  1.0596/  0.6499,  0.9224/  0.9404,  0.9224/  0.6499,  1.6684/  0.3316,  1.6684/ -0.3316,  1.6499/  0.3316,  1.6499/ -0.3316,  1.4818/  0.0948,  1.4818/ -0.5182,  1.4807/  0.0948,  1.4807/ -0.5182,  1.6210/  0.3790,  1.6210/ -0.2075,  1.5962/  0.3790,  1.5962/ -0.2075,  1.5171/  0.4829,  1.5171/ -0.0407,  1.4796/  0.4829,  1.4796/ -0.0407,  1.5486/  0.4514,  1.5486/ -0.0928,  1.5190/  0.4514,  1.5190/ -0.0928,  1.3333/ -0.0906,  1.3333/ -0.6667,  1.3333/ -0.0906,  1.3333/ -0.6667,  1.2644/  0.7356,  1.2644/  0.3429,  1.1714/  0.7356,  1.1714/  0.3429,  0.2333/ -1.3435,  0.2333/ -1.7667, -0.2333/ -1.3435, -0.2333/ -1.7667, -0.1361/ -1.1944, -0.1361/ -1.4875, -0.5125/ -1.1944, -0.5125/ -1.4875, -0.5663/ -0.9938, -0.5663/ -1.1326, -0.8674/ -0.9938, -0.8674/ -1.1326, -1.6720/  0.2560, -1.6720/ -0.3039, -1.6961/  0.2560, -1.6961/ -0.3039, -1.6815/  0.2968, -1.6815/ -0.2968, -1.7032/  0.2968, -1.7032/ -0.2968, -1.4807/  0.5182, -1.4807/ -0.0145, -1.4818/  0.5182, -1.4818/ -0.0145} {
%   \draw[cyan] (\x-.02,\y-.02) -- (\x+.02,\y+.02); 
%   \draw[cyan] (\x-.02,\y+.02) -- (\x+.02,\y-.02);
%   }

\draw[cyan] (  0.2333,  1.7667) -- (  0.2333,  1.4511) -- ( -0.2333,  1.4511) -- ( -0.2333,  1.7667) -- cycle;
\draw[cyan] (  0.5125,  1.4875) -- (  0.5125,  1.3157) -- (  0.1361,  1.3157) -- (  0.1361,  1.4875) -- cycle;
\draw[cyan] (  0.5482,  1.4518) -- (  0.5482,  1.2973) -- (  0.1793,  1.2973) -- (  0.1793,  1.4518) -- cycle;
\draw[cyan] ( -1.3333,  0.6667) -- ( -1.3333,  0.1672) -- ( -1.3333,  0.1672) -- ( -1.3333,  0.6667) -- cycle;
\draw[cyan] ( -1.0649, -0.5786) -- ( -1.0649, -0.7979) -- ( -1.2021, -0.7979) -- ( -1.2021, -0.5786) -- cycle;
\draw[cyan] ( -1.5073, -0.0145) -- ( -1.5073, -0.4386) -- ( -1.5614, -0.4386) -- ( -1.5614, -0.0145) -- cycle;
\draw[cyan] ( -1.6039,  0.1353) -- ( -1.6039, -0.3664) -- ( -1.6336, -0.3664) -- ( -1.6336,  0.1353) -- cycle;
\draw[cyan] (  1.0596,  0.9404) -- (  1.0596,  0.6499) -- (  0.9224,  0.6499) -- (  0.9224,  0.9404) -- cycle;
\draw[cyan] (  1.6684,  0.3316) -- (  1.6684, -0.3316) -- (  1.6499, -0.3316) -- (  1.6499,  0.3316) -- cycle;
\draw[cyan] (  1.4818,  0.0948) -- (  1.4818, -0.5182) -- (  1.4807, -0.5182) -- (  1.4807,  0.0948) -- cycle;
\draw[cyan] (  1.6210,  0.3790) -- (  1.6210, -0.2075) -- (  1.5962, -0.2075) -- (  1.5962,  0.3790) -- cycle;
\draw[cyan] (  1.5171,  0.4829) -- (  1.5171, -0.0407) -- (  1.4796, -0.0407) -- (  1.4796,  0.4829) -- cycle;
\draw[cyan] (  1.5486,  0.4514) -- (  1.5486, -0.0928) -- (  1.5190, -0.0928) -- (  1.5190,  0.4514) -- cycle;
\draw[cyan] (  1.3333, -0.0906) -- (  1.3333, -0.6667) -- (  1.3333, -0.6667) -- (  1.3333, -0.0906) -- cycle;
\draw[cyan] (  1.2644,  0.7356) -- (  1.2644,  0.3429) -- (  1.1714,  0.3429) -- (  1.1714,  0.7356) -- cycle;
\draw[cyan] (  0.2333, -1.3435) -- (  0.2333, -1.7667) -- ( -0.2333, -1.7667) -- ( -0.2333, -1.3435) -- cycle;
\draw[cyan] ( -0.1361, -1.1944) -- ( -0.1361, -1.4875) -- ( -0.5125, -1.4875) -- ( -0.5125, -1.1944) -- cycle;
\draw[cyan] ( -0.5663, -0.9938) -- ( -0.5663, -1.1326) -- ( -0.8674, -1.1326) -- ( -0.8674, -0.9938) -- cycle;
\draw[cyan] ( -1.6720,  0.2560) -- ( -1.6720, -0.3039) -- ( -1.6961, -0.3039) -- ( -1.6961,  0.2560) -- cycle;
\draw[cyan] ( -1.6815,  0.2968) -- ( -1.6815, -0.2968) -- ( -1.7032, -0.2968) -- ( -1.7032,  0.2968) -- cycle;
\draw[cyan] ( -1.4807,  0.5182) -- ( -1.4807, -0.0145) -- ( -1.4818, -0.0145) -- ( -1.4818,  0.5182) -- cycle;


\draw[thin,dash dot,gray] (0.7778,1.5556) -- (-0.7778,-1.5556);
\draw[thin,dash dot,gray] (-1.5556,0.7778) -- (1.5556,-0.7778);
\end{tikzpicture}
% \caption[The parametric Pontryagin difference of a parametrically convex PWA set-valued map.]{The resulting set~$\mathcal X\ominus\mathcal W(\mathcal X)$ for Example~\ref{example:most:complex:pontryagin:difference:ever} in \textcolor{blue}{blue}, its vertices~$v_i$ marked by \textcolor{green!80!black}{green} circles, in \textcolor{red}{red} the set~$\mathcal X$, \textcolor{cyan}{cyan} boxes outline $\{v_i\}\oplus\mathcal W(v_i)$, \textcolor{magenta}{magenta} rectangles mark the actual value of $f(v_i)$, notice that each~$f(v_i)\in\{v_i\}\oplus\mathcal W(v_i)$ as required, and dash-dotted lines show the $x_1-\frac{x_2}{2}=0$ and $\frac{x_1}{2}+x_2=0$ planes.}


% \includegraphics[width=.95\textwidth]{complexPonDiff.pdf}
\caption{In red~$X_l$, outlined in blue~$X_{l+1}$, its vertices~$v_i$ marked by green circles, in cyan we outline $\{v_i\}\oplus\mathcal W(v_i)$, the red squares mark the actual value of $f(v_i)$ and dotted lines show the $x_1-\frac{x_2}{2}=0$ and $\frac{x_1}{2}+x_2=0$ planes.}
\label{fig:second:example:resulting:set}
\end{figure}
%
%
%
%
%
\section{Conclusions}\label{sec:conclusion}
%
%
%
In this paper we present a way to extend the scope of the Pontryagin
difference operation to a wide class of sets and set-valued maps.
%
We introduce the framework of parametric convexity and related analysis, which proves essential for the convexity of the parametric Pontryagin difference.
%
Furthermore we provide the link required to make the parametric Pontryagin difference computationally accessible for polytopic sets, this relies on the combinatorial nature of the subtrahend set-valued map.
%
Using two simple examples we illustrate the potency of the proposed methodology.

The parametric Pontryagin difference has been used successfully in robust control applications~\cite{Schaich:2015,Schaich:2015a} and this work will further extend its scope of application.

\bibliographystyle{plain}
\bibliography{Bibliography}

\end{document}